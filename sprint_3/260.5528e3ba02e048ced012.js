"use strict";(self.webpackChunkecommerce_application=self.webpackChunkecommerce_application||[]).push([[260],{5448:(t,e,i)=>{i.r(e),i.d(e,{default:()=>b});const s="registrationView__inputsGroup--s2afB",n="registrationView__form--yXlDY",a="registrationView__defaultSelect--za2h9";var l,r=i(1567),u=i(8717),d=i(5476),h=i(928),o=i(5311);!function(t){t.SUBMIT="submit",t.BUTTON="button"}(l||(l={}));const p=l;var I;!function(t){t[t.EMAIL=0]="EMAIL",t[t.PASSWORD=1]="PASSWORD",t[t.REPEAT_PASSWORD=2]="REPEAT_PASSWORD",t[t.FIRST_NAME=3]="FIRST_NAME",t[t.LAST_NAME=4]="LAST_NAME",t[t.DATE_OF_BIRTH=5]="DATE_OF_BIRTH",t[t.SHIPPING_STREET=6]="SHIPPING_STREET",t[t.SHIPPING_CITY=7]="SHIPPING_CITY",t[t.SHIPPING_POSTAL=8]="SHIPPING_POSTAL",t[t.SHIPPING_COUNTRY=9]="SHIPPING_COUNTRY",t[t.BILLING_STREET=10]="BILLING_STREET",t[t.BILLING_CITY=11]="BILLING_CITY",t[t.BILLING_POSTAL=12]="BILLING_POSTAL",t[t.BILLING_COUNTRY=13]="BILLING_COUNTRY"}(I||(I={}));const g=I;var c,A=i(423),S=i(2123),L=i(6193),T=i(4121),E=i(891),_=i(5429),m=i(7881),P=i(4296);!function(t){t[t.SWITCH_TO_PAGE=2e3]="SWITCH_TO_PAGE"}(c||(c={}));const C=c;var N=i(4218),D=i(2953),B=i(5246),G=i(4957);class b extends h.Z{constructor(t){super({tag:r.Z.SECTION,classNames:["registrationView--n6v1f"],textContent:""}),this.DEFAULT_ADDRESS_NUMBER=1,this.router=t,this.observer=P.Z.getInstance(),this.mainInputsGroup=this.fillInputsGroups(this.createMainParams()),this.shippingInputsGroup=this.fillInputsGroups(this.createShippingAddressParams()),this.billingInputsGroup=this.fillInputsGroups(this.createBillingAddressParams()),this.inputs=[...this.mainInputsGroup,...this.shippingInputsGroup,...this.billingInputsGroup],this.checkValidityElement=this.createValidMessageElement(),this.buttonDefaultShippingAddress=this.createDefaultButton(L.Z.BUTTON_DEFAULT,[a]),this.buttonDefaultBillingAddress=this.createDefaultButton(L.Z.BUTTON_DEFAULT,[a]),this.buttonAddAddress=this.createDefaultButton(L.Z.REMOVE_BILLING_ADDRESS,["registrationView__buttonAddAdsress--xXsVy"]),this.billingLabel=this.createLabel(u.Yk.BILLING_ADDRESS),this.shippingLabel=this.createLabel(u.Yk.SHIPPING_ADDRESS),this.isDefaultShippingAddress=!1,this.isDefaultBillingAddress=!1,this.isBillingAddress=!0,this.countryOption=new B.Z,this.countryList=this.countryOption.getListElement(),this.configView()}configView(){const t=this.createTitle(),e=this.createDescription(),i=this.createForm(),s=document.createElement(r.Z.BUTTON);s.textContent=L.Z.TO_LOGIN,s.classList.add("button--pcOys"),s.addEventListener(o.Z.CLICK,this.redirectLoginhandler.bind(this)),this.buttonAddAddress.addEventListener(o.Z.CLICK,this.toggleBillingAddressHandler.bind(this)),this.getElement().append(t,e,s,i,this.buttonAddAddress,this.countryList)}redirectLoginhandler(){this.router.navigate(E._.LOGIN)}createValidMessageElement(){const t=document.createElement(r.Z.DIV);return t.textContent=L.Z.CHECK_VALIDITY,t.classList.add("registrationView__checkValidity--z5NU8"),t.addEventListener(o.Z.CLICK,this.removeValidityMessageHandler.bind(this)),t}removeValidityMessageHandler(){this.checkValidityElement.textContent=L.Z.CHECK_VALIDITY,this.getElement().removeChild(this.checkValidityElement)}createLabel(t){const e=document.createElement("label");return e.textContent=t,e.classList.add(s),e}createTitle(){const t=document.createElement("h1");return t.classList.add("registrationView__tittle--nXz7b"),t.textContent=L.Z.TITLE,t}createDescription(){const t=document.createElement("p");return t.classList.add("registrationView__description--qhfiP"),t.textContent=L.Z.DESCRIPTION,t}fillInputsGroups(t){const e=[];return t.forEach((t=>{const i=new d.Z(t);e.push(i)})),e}createForm(){const t=document.createElement("form");t.classList.add(n);const e=document.createElement(r.Z.DIV);e.classList.add(s);const i=this.mainInputsGroup.map((t=>t.getElement()));e.append(...i);const a=this.creatLabelWithGroup(u.Yk.SHIPPING_ADDRESS,this.shippingInputsGroup),l=this.creatLabelWithGroup(u.Yk.BILLING_ADDRESS,this.billingInputsGroup),d=document.createElement(r.Z.BUTTON);d.classList.add("registrationView__button--zQmzn"),d.type=p.BUTTON,d.textContent=L.Z.BUTTON_SUBMIT,d.addEventListener(o.Z.CLICK,this.formSubmitHandler.bind(this));const h=document.createElement(r.Z.DIV);return h.classList.add("registrationView__buttonWrap--Nq_7J"),h.append(d),t.append(e,a,l,h),t}creatLabelWithGroup(t,e){const i=e.map((t=>t.getElement()));let s=document.createElement("label");return t===u.Yk.SHIPPING_ADDRESS&&(this.shippingLabel.append(...i),this.shippingLabel.append(this.buttonDefaultShippingAddress),this.buttonDefaultShippingAddress.addEventListener(o.Z.CLICK,this.defaultShippingToggleHandler.bind(this)),s=this.shippingLabel),t===u.Yk.BILLING_ADDRESS&&(this.billingLabel.append(...i),this.billingLabel.append(this.buttonDefaultBillingAddress),this.buttonDefaultBillingAddress.addEventListener(o.Z.CLICK,this.defaultBillingToggleHandler.bind(this)),s=this.billingLabel),s}createDefaultButton(t,e){const i=document.createElement(r.Z.BUTTON);return i.type=p.BUTTON,i.textContent=t,i.classList.add(...e),i}passwordCheckHandler(){const t=this.inputs[g.REPEAT_PASSWORD];this.inputs[g.PASSWORD].getInputValue()===t.getInputValue()?(t.setCustomValidity(""),t.removeMessage()):(t.setMessageError(u.WA.PASSWORD_REPEAT),t.setCustomValidity(u.WA.PASSWORD_REPEAT))}validateCountryShippingHandler(){this.validateCountryList(this.inputs[g.SHIPPING_COUNTRY],this.inputs[g.SHIPPING_POSTAL])}validateCountryBillingHandler(){this.validateCountryList(this.inputs[g.BILLING_COUNTRY],this.inputs[g.BILLING_POSTAL])}validateCountryList(t,e){const i=this.countryOption.getCountryList(),s=t,n=e,a=s.getInputValue();i.flat().includes(a)?(this.changePostalPatternWithCountry(n,i,a),s.setCustomValidity("")):(s.setCustomValidity(u.WA.COUNTRY_HINT),this.changePostalPatternWithOutCountry(n))}changePostalPatternWithCountry(t,e,i){e.forEach(((e,s)=>{if(e.includes(i)){const e=Array.from(Object.values(A.Z))[s];t.setPattern(e);const n=Array.from(Object.values(S.Z))[s],a=`${i.slice(0,-3)}\`s postal ${n}`;t.setTitle(a),t.setMessageError(a),t.setCustomValidity("")}}))}changePostalPatternWithOutCountry(t){t.setTitle(u.WA.WRONG_COUNTRY),t.setMessageError(u.WA.WRONG_COUNTRY),t.setCustomValidity(u.WA.WRONG_COUNTRY)}defaultBillingToggleHandler(){this.isDefaultBillingAddress?(this.isDefaultBillingAddress=!1,this.buttonDefaultBillingAddress.textContent=L.Z.BUTTON_DEFAULT,this.billingLabel.firstChild.textContent=u.Yk.BILLING_ADDRESS):(this.isDefaultBillingAddress=!0,this.buttonDefaultBillingAddress.textContent=L.Z.BUTTON_UN_DEFAULT,this.billingLabel.firstChild.textContent=u.Yk.BILLING_ADDRESS_DEFAULT)}defaultShippingToggleHandler(){this.isDefaultShippingAddress?(this.isDefaultShippingAddress=!1,this.buttonDefaultShippingAddress.textContent=L.Z.BUTTON_DEFAULT,this.shippingLabel.firstChild.textContent=u.Yk.SHIPPING_ADDRESS):(this.isDefaultShippingAddress=!0,this.buttonDefaultShippingAddress.textContent=L.Z.BUTTON_UN_DEFAULT,this.shippingLabel.firstChild.textContent=u.Yk.SHIPPING_ADDRESS_DEFAULT)}toggleBillingAddressHandler(){const t=this.shippingLabel.parentNode;this.isBillingAddress?(this.isBillingAddress=!1,this.buttonAddAddress.textContent=L.Z.ADD_BILLING_ADDRESS,t.removeChild(this.billingLabel)):(this.isBillingAddress=!0,this.buttonAddAddress.textContent=L.Z.REMOVE_BILLING_ADDRESS,t.insertBefore(this.billingLabel,this.shippingLabel))}changeInputDateHandler(){!0===this.inputs[g.DATE_OF_BIRTH].getInput().checkValidity()?this.inputs[g.DATE_OF_BIRTH].setMessageError(""):this.inputs[g.DATE_OF_BIRTH].setMessageError(u.WA.DATE_OF_BIRTH_HINT)}getParams(){return{email:this.inputs[g.EMAIL].getInputValue(),password:this.inputs[g.PASSWORD].getInputValue(),firstName:this.inputs[g.FIRST_NAME].getInputValue(),lastName:this.inputs[g.LAST_NAME].getInputValue(),dateOfBirth:this.inputs[g.DATE_OF_BIRTH].getInputValue(),countryStreetShipping:this.inputs[g.SHIPPING_STREET].getInputValue(),countryCityShipping:this.inputs[g.SHIPPING_CITY].getInputValue(),countryPostalShipping:this.inputs[g.SHIPPING_POSTAL].getInputValue(),countryShippingCode:this.inputs[g.SHIPPING_COUNTRY].getInputValue().slice(-2),countryStreetBilling:this.isBillingAddress?this.inputs[g.BILLING_STREET].getInputValue():this.inputs[g.SHIPPING_STREET].getInputValue(),countryCityBilling:this.isBillingAddress?this.inputs[g.BILLING_CITY].getInputValue():this.inputs[g.SHIPPING_CITY].getInputValue(),countryPostalBilling:this.isBillingAddress?this.inputs[g.BILLING_POSTAL].getInputValue():this.inputs[g.SHIPPING_POSTAL].getInputValue(),countryBillingCode:this.isBillingAddress?this.inputs[g.BILLING_COUNTRY].getInputValue().slice(-2):this.inputs[g.SHIPPING_COUNTRY].getInputValue().slice(-2),key:`${Date.now().toString(16)}-${Math.trunc(1e10*Math.random()).toString(16)}`,defaultShippingAddressNum:this.isDefaultShippingAddress?0:void 0,defaultBillingAddressNum:this.getDefaultBillinAddressNum()}}getDefaultBillinAddressNum(){let t;return t=this.isBillingAddress?this.isDefaultBillingAddress?1:void 0:this.isDefaultShippingAddress?1:void 0,t}formSubmitHandler(){if(this.isCheckValidityFormHandler()){const t=new T.Z,e=this.getParams(),i={email:this.inputs[g.EMAIL].getInputValue(),password:this.inputs[g.PASSWORD].getInputValue()};t.createCustomer(e).then((t=>{t.statusCode===N.Z.USER_CREATED&&(this.checkValidityElement.textContent=L.Z.REGISTRATION_OK,this.getElement().append(this.checkValidityElement),setTimeout((()=>this.router.navigate(E._.LOGIN)),C.SWITCH_TO_PAGE))})).then((()=>{this.makeLogin(i)})).catch((t=>{this.checkValidityElement.textContent=t.message,this.getElement().append(this.checkValidityElement)}))}else this.getElement().append(this.checkValidityElement)}makeLogin(t){(new _.Z).getCustomer(t).then((e=>{e.body.customer&&(window.localStorage.setItem("isLogin","true"),window.localStorage.setItem(D.Z.MAIL_ADDRESS,t.email),this.observer.notify(m.Z.LOGIN))}))}isCheckValidityFormHandler(){let t=!0;return this.mainInputsGroup.forEach((e=>{e.getInput().checkValidity()||(t=!1)})),this.shippingInputsGroup.forEach((e=>{e.getInput().checkValidity()||(t=!1)})),this.isBillingAddress&&this.billingInputsGroup.forEach((e=>{e.getInput().checkValidity()||(t=!1)})),t}createMainParams(){const t=new G.Z,e=[n];return[t.getMailParams([n]),t.getPasswordParams(e,[[this.passwordCheckHandler.bind(this),o.Z.CHANGE]]),t.getPasswordRepeatParams(e,[[this.passwordCheckHandler.bind(this),o.Z.CHANGE]]),t.getFirstNameParams(e),t.getLastNameParams(e),t.getDateParams(e,[[this.changeInputDateHandler.bind(this),o.Z.CLICK]])]}createShippingAddressParams(){const t=new G.Z,e=[n];return[t.getStreetParams(e),t.getCityParams(e),t.getSPostalParams(e),t.getCountryParams(e,[[this.validateCountryShippingHandler.bind(this),o.Z.CHANGE]])]}createBillingAddressParams(){const t=new G.Z,e=[n];return[t.getStreetParams(e),t.getCityParams(e),t.getSPostalParams(e),t.getCountryParams(e,[[this.validateCountryBillingHandler.bind(this),o.Z.CHANGE]])]}}}}]);