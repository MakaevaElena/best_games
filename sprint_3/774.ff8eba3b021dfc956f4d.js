"use strict";(self.webpackChunkecommerce_application=self.webpackChunkecommerce_application||[]).push([[774],{6140:(e,t,s)=>{s.r(t),s.d(t,{default:()=>W});const i={wrap:"wrap--DHYWB"};var a=s(1567),n=s(6249),r=s(4602),o=s(891),l=s(213),d=s(928);var u,h=s(4121);!function(e){e.ADD_SHIPPING_ADDRESS_BUTTON="add shipping address",e.ADD_BILLING_ADDRESS_BUTTON="add billing address",e.REMOVE_SHIPPING_ADDRESS_BUTTON="remove shipping address",e.REMOVE_BILLING_ADDRESS_BUTTON="remove billing address",e.TITLE_ADDRESS_SHIPPING="shipping addresses",e.TITLE_ADDRESS_BILLING="billing addresses",e.DEFAULT_ADDRESS="default address",e.REDACTION_MODE_BUTTON="edit",e.CONFIRM_BUTTON="confirm",e.CANCEL_BUTTON="cancel",e.CONFIRM_MESSAGE_INFO="new data successfully saved",e.CANCEL_MESSAGE_INFO="modifications have been canceled",e.CHANGE_COUNTRY_INFO="Don't forget to change the postal code according to the selected country",e.VALIDATE_INPUT_BEFORE_SUBMIT="Make sure you fill out your account correctly"}(u||(u={}));const c=u;var m=s(4296),E=s(7881),p=s(2953),g=s(5246),A=s(4957);const N={"field-group":"field-group--magme"},I={"field-view":"field-view--kJ8a8"},D={active:"active--GNwPO"},C={"redaction-button":"redaction-button--gfaO6"};var _=s(5311),T=s(22),v=s(8624),S=s(3226);const O={button:"button--p_MbL"};class F{constructor(e,t,s,i){this.textContent=e,this.classList=t,this.eventListener=s,this.event=i,this.button=this.createButton()}getButton(){return this.button}createButton(){const e=document.createElement(a.Z.BUTTON);return e.textContent=this.textContent,e.classList.add(...Object.values(O)),this.classList&&e.classList.add(...this.classList),this.eventListener&&this.event&&e.addEventListener(this.event,this.eventListener),e}}var f,w=s(5476);!function(e){e.EMAIL_ADDRESS="email",e.FIRST_NAME="firstName",e.LAST_NAME="lastName",e.DATE_OF_BIRTH="dateOfBirth"}(f||(f={}));const L=f;var M,B=s(4218);class b{constructor(e){this.elementField=this.createElementField(),this.inputElement=new w.Z(e.inputParams),this.value=e.value,this.labelValue=e.inputParams.attributes.placeholder,this.action=e.action,this.actionName=e.actionName,this.id=e.id,this.cancelButton=this.createCancelButton(),this.confirmButton=this.createConfirmButton(),this.redactionModeButton=this.createRedactionModeButton(),this.configureView()}getElement(){return this.elementField}getInputElement(){return this.inputElement}createElementField(){const e=document.createElement(a.Z.DIV);return e.classList.add(...Object.values(I)),e}configureView(){this.configureInputElement(),this.elementField.append(this.inputElement.getElement(),this.redactionModeButton)}configureInputElement(){this.inputElement.setDisabled(),this.inputElement.setInputValue(this.value),this.inputElement.setLabel(this.labelValue),this.inputElement.removeMessageElement()}createRedactionModeButton(){return this.createButton(c.REDACTION_MODE_BUTTON,Object.values(C),this.redactionModeHandler.bind(this),_.Z.CLICK)}createConfirmButton(){return this.createButton(c.CONFIRM_BUTTON,Object.values(C),this.saveValueHandler.bind(this),_.Z.CLICK)}createCancelButton(){return this.createButton(c.CANCEL_BUTTON,Object.values(C),this.cancelValueHandler.bind(this),_.Z.CLICK)}createButton(e,t,s,i){return new F(e,t,s,i).getButton()}showInfoMessage(e){(new S.Z).showMessage(e)}showErrorMessage(e){(new v.Z).showMessage(e)}showWarningMessage(e){(new T.Z).showMessage(e)}redactionModeHandler(){this.value=this.inputElement.getInputValue(),this.inputElement.appendMessage(),this.elementField.removeChild(this.redactionModeButton),this.inputElement.removeDisabled(),this.elementField.append(this.confirmButton,this.cancelButton),this.elementField.classList.add(...Object.values(D))}saveValueHandler(){this.value=this.inputElement.getInputValue(),this.inputElement.getInput().checkValidity()?(this.exitEditModeChangeButton(),this.saveValue()):this.showWarningMessage(c.VALIDATE_INPUT_BEFORE_SUBMIT)}cancelValueHandler(){this.exitEditModeChangeButton(),this.inputElement.setInputValue(this.value),this.showInfoMessage(c.CANCEL_MESSAGE_INFO)}exitEditModeChangeButton(){this.inputElement.setDisabled(),this.elementField.removeChild(this.confirmButton),this.elementField.removeChild(this.cancelButton),this.inputElement.removeMessageElementFromLabel(),this.elementField.append(this.redactionModeButton),this.elementField.classList.remove(...Object.values(D))}saveValue(){const e=new h.Z;e.getCustomer(window.localStorage.getItem(p.Z.MAIL_ADDRESS)).then((t=>{e.changeData(this.id,t.body.results[0].version,this.action,this.actionName,this.value).then((e=>{this.actionName===L.EMAIL_ADDRESS&&window.localStorage.setItem(p.Z.MAIL_ADDRESS,this.value),e.statusCode===B.Z.USER_VALUE_CHANGED&&this.showInfoMessage(c.CONFIRM_MESSAGE_INFO)})).catch((e=>{this.showErrorMessage(e.message)}))})).catch((e=>{this.showErrorMessage(e.message)}))}}class R{constructor(e){this.mainFieldGroup=this.createMainFieldGroupElement(),this.userFieldsProps=e,this.userFieldElements=this.createUserFieldsElements(),this.configureView()}getElement(){return this.mainFieldGroup}configureView(){this.mainFieldGroup.append(...this.userFieldElements)}createMainFieldGroupElement(){const e=document.createElement(a.Z.DIV);return e.classList.add(...Object.values(N)),e}createUserFieldsElements(){const e=[];return this.userFieldsProps.forEach((t=>{const s=new b(t);e.push(s.getElement())})),e}}!function(e){e[e.ID=0]="ID",e[e.CITY=1]="CITY",e[e.POSTAL=2]="POSTAL",e[e.STREET=3]="STREET",e[e.COUNTRY=4]="COUNTRY",e[e.IS_DEFAULT=5]="IS_DEFAULT"}(M||(M={}));const P=M;var y,G=s(8717),U=s(423),V=s(2123);class Z{constructor(e,t,s){this.addressGroup=this.createAddressFieldGroupElement(),this.values=e,this.countryOptions=new g.Z,this.inputsParams=new A.Z,this.title=this.createTitle(t),this.streetField=this.createStreetField(),this.cityField=this.createCityField(),this.postalField=this.createPostalField(),this.countryField=this.createCountryField(),this.countryField.getElement().addEventListener(_.Z.CHANGE,this.validateCountryListHandler.bind(this)),this.countryField.getElement().addEventListener("change",this.changeCountryHandler.bind(this)),this.configureView(),this.makeAddressDefault(s)}getElement(){return this.addressGroup}configureView(){this.addressGroup.append(this.title,this.streetField.getElement(),this.cityField.getElement(),this.postalField.getElement(),this.countryField.getElement(),this.countryOptions.getListElement())}createAddressFieldGroupElement(){const e=document.createElement(a.Z.DIV);return e.classList.add(...Object.values(N)),e}createStreetField(){const e={id:"this.userData.id",action:"",actionName:"",value:this.values[P.STREET],inputParams:this.inputsParams.getStreetParams()};return new b(e)}createCityField(){const e={id:"this.userData.id",action:"",actionName:"",value:this.values[P.CITY],inputParams:this.inputsParams.getCityParams()};return new b(e)}createPostalField(){const e={id:"this.userData.id",action:"",actionName:"",value:this.values[P.POSTAL],inputParams:this.inputsParams.getSPostalParams()};return new b(e)}createCountryField(){const e={id:"this.userData.id",action:"",actionName:"",value:this.countryOptions.getCountryByCode(this.values[P.COUNTRY]),inputParams:this.inputsParams.getCountryParams()};return new b(e)}createTitle(e){const t=document.createElement("h3");return t.textContent=e,t}makeAddressDefault(e){if(e){const e=this.createTitle(c.DEFAULT_ADDRESS);this.addressGroup.append(e)}}changeCountryHandler(){this.showInfoMessage(c.CHANGE_COUNTRY_INFO)}validateCountryListHandler(){const e=this.countryOptions.getCountryList(),t=this.countryField.getInputElement(),s=this.postalField.getInputElement(),i=t.getInputValue();e.flat().includes(i)?(this.changePostalPatternWithCountry(s,e,i),t.setCustomValidity("")):(t.setCustomValidity(G.WA.COUNTRY_HINT),this.changePostalPatternWithOutCountry(s))}changePostalPatternWithCountry(e,t,s){t.forEach(((t,i)=>{if(t.includes(s)){const t=Array.from(Object.values(U.Z))[i];e.setPattern(t);const a=Array.from(Object.values(V.Z))[i],n=`${s.slice(0,-3)}\`s postal ${a}`;e.setTitle(n),e.setMessageError(n),e.setCustomValidity("")}}))}changePostalPatternWithOutCountry(e){e.setTitle(G.WA.WRONG_COUNTRY),e.setMessageError(G.WA.WRONG_COUNTRY),e.setCustomValidity(G.WA.WRONG_COUNTRY)}showInfoMessage(e){(new S.Z).showMessage(e)}}!function(e){e.CHANGE_EMAIL_ADDRESS="changeEmail",e.CHANGE_FIRST_NAME="setFirstName",e.CHANGE_LAST_NAME="setLastName",e.CHANGE_DATE_OF_BIRTH="setDateOfBirth"}(y||(y={}));const H=y;class W extends d.Z{constructor(e){super({tag:a.Z.SECTION,classNames:["profile-view--tXFs_"],textContent:""}),this.router=e,this.emailAddress=window.localStorage.getItem(p.Z.MAIL_ADDRESS),this.observer=m.Z.getInstance(),this.countryOptions=new g.Z,this.wrapper=(new n.Z).createTagElement("div",["content-wrapper--LuY91"]),this.getCreator().addInnerElement(this.wrapper),this.userData=this.request(),this.configView(),this.observer.subscribe(E.Z.LOGIN,this.login.bind(this)),this.observer.subscribe(E.Z.LOGOUT,this.logoutListener.bind(this))}setContent(e){this.wrapper.replaceChildren(""),e instanceof r.Z?this.wrapper.append(e.getElement()):this.wrapper.append(e)}configView(){this.createContent()}login(){this.emailAddress=window.localStorage.getItem(p.Z.MAIL_ADDRESS),this.userData=this.request()}logoutListener(){this.wrapper.textContent="";const e=this.createMainButton();this.wrapper.append(e.getElement())}createContent(){this.wrapper.textContent="";const e=this.createMainButton();this.wrapper.append(e.getElement());const t=this.createUserField(),s=(new n.Z).createTagElement("div",Object.values(i)),a=this.createAddressGroup(this.userData.shippingAddresses),r=this.createAddressGroup(this.userData.billingAddresses);s.append(t,...a,...r),this.wrapper.append(s)}createMainButton(){return new l.Z(o.bm.INDEX,(()=>{this.router.navigate(o._.INDEX)}))}request(){const e=new h.Z,t=this.createUserData(),s=this.emailAddress;return s&&e.getCustomer(s).then((e=>{const s=e.body.results[0];return null!=s.id&&(t.id=s.id),null!=s.version&&(t.version=s.version),null!=s.firstName&&(t.firstName=s.firstName),null!=s.lastName&&(t.lastName=s.lastName),null!=s.dateOfBirth&&(t.dateOfBirth=s.dateOfBirth),t.shippingAddresses=this.getShippingBillingAddresses(s.addresses,s.shippingAddressIds,s.defaultShippingAddressId),t.billingAddresses=this.getShippingBillingAddresses(s.addresses,s.billingAddressIds,s.defaultBillingAddressId),this.configView(),t})).catch((e=>{console.log(e.message)})),t}getShippingBillingAddresses(e,t,s){const i=[];return void 0!==t&&e.forEach((e=>{t.includes(e.id)&&(e.id===s&&(e.isDefault=!0),i.push(e))})),i}createAddressGroup(e){const t=[];let s="";return s=e===this.userData.shippingAddresses?c.TITLE_ADDRESS_SHIPPING:c.TITLE_ADDRESS_BILLING,e.forEach((e=>{const i=[];Object.values(e).forEach((e=>{"boolean"!=typeof e&&i.push(e)}));const a=new Z(i,s,e.isDefault);t.push(a.getElement())})),t}createMainProps(){const e=new A.Z;return[{id:this.userData.id,action:H.CHANGE_EMAIL_ADDRESS,actionName:L.EMAIL_ADDRESS,value:this.emailAddress,inputParams:e.getMailParams()},{id:this.userData.id,action:H.CHANGE_FIRST_NAME,actionName:L.FIRST_NAME,value:this.userData.firstName,inputParams:e.getFirstNameParams()},{id:this.userData.id,action:H.CHANGE_LAST_NAME,value:this.userData.lastName,actionName:L.LAST_NAME,inputParams:e.getLastNameParams()},{id:this.userData.id,action:H.CHANGE_DATE_OF_BIRTH,value:this.userData.dateOfBirth,actionName:L.DATE_OF_BIRTH,inputParams:e.getDateParams()}]}createUserData(){const e="unassigned";return{id:e,version:0,firstName:e,lastName:e,dateOfBirth:e,shippingAddresses:[{city:e,country:e,id:e,postalCode:e,streetName:e,isDefault:!1}],billingAddresses:[{city:e,country:e,id:e,postalCode:e,streetName:e,isDefault:!1}]}}createUserField(){const e=this.createMainProps();return new R(e).getElement()}}}}]);