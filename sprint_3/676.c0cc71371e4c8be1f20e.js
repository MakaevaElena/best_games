"use strict";(self.webpackChunkecommerce_application=self.webpackChunkecommerce_application||[]).push([[676],{4068:(e,t,r)=>{r.d(t,{p0:()=>n});var s=r(9631);class i{static newGuid(){const e=[];return e.push(i.getHexRandom(268435456,4294967295)),e.push(i.getHexRandom(4096,65535)),e.push(i.getHexRandom(4096,65535)),e.push(i.getHexRandom(4096,65535)),e.push(i.getHexRandom(17592186044416,0xffffffffffff)),e.join("-")}static getHexRandom(e,t){return Math.floor(e+Math.random()*(t+1-e)).toString(16)}}const a="best-games",n=()=>{const e={host:"https://auth.europe-west1.gcp.commercetools.com",projectKey:a,credentials:{clientId:"A8PxwfHMEiItZ24oahyDGO2A",clientSecret:"RKi7doGwQ75b4wfuLsPuahDT366uOhUY",anonymousId:`best-games-${i.newGuid()}`},scopes:[`manage_project:${a}`]};return(new s.Qx).withAnonymousSessionFlow(e).withProjectKey(a).withHttpMiddleware({host:"https://api.europe-west1.gcp.commercetools.com"}).withLoggerMiddleware().build()}},5233:(e,t,r)=>{r.d(t,{r4:()=>a});var s=r(9631);const i="best-games",a=(e,t)=>{const r={host:"https://auth.europe-west1.gcp.commercetools.com",projectKey:i,credentials:{clientId:"A8PxwfHMEiItZ24oahyDGO2A",clientSecret:"RKi7doGwQ75b4wfuLsPuahDT366uOhUY",user:{username:e,password:t}},scopes:[`manage_project:${i}`],fetch},a={host:"https://api.europe-west1.gcp.commercetools.com",fetch};return(new s.Qx).withPasswordFlow(r).withProjectKey(i).withHttpMiddleware(a).withLoggerMiddleware().build()}},3676:(e,t,r)=>{r.r(t),r.d(t,{default:()=>N});var s,i=r(3037),a=r(4068),n=r(5233);!function(e){e.ENUM_ATTRIBUTE_MASK="variants.attributes.%ATTRIBUTE%.key:%VALUE%",e.TEXT_ATTRIBUTE_MASK="variants.attributes.%ATTRIBUTE%:%VALUE%",e.PRICE_FILTER_MASK="variants.scopedPrice.currentValue.centAmount:range (%MIN% to %MAX%)"}(s||(s={}));class c{constructor(e){if(this.clientRoot=(0,i.mv)((0,a.p0)()).withProjectKey({projectKey:"best-games"}),this.MAX_PRODUCTS=500,e){const t=(0,n.r4)(e.email,e.password);this.clientRoot=(0,i.mv)(t).withProjectKey({projectKey:"best-games"})}}getAllProducts(){return this.clientRoot.products().get({queryArgs:{limit:this.MAX_PRODUCTS}}).execute()}getProducts(e){const t={...e};return this.clientRoot.productProjections().search().get({queryArgs:t}).execute()}getCategories(){return this.clientRoot.categories().get({queryArgs:{expand:"ancestors.id"}}).execute()}getProductbyID(e){return this.clientRoot.products().withId({ID:e}).get().execute()}getProductbyKey(e){return this.clientRoot.products().withKey({key:e}).get().execute()}productProjectionResponseID(e){return this.clientRoot.productProjections().withId({ID:e}).get({queryArgs:{staged:!0}}).execute()}productProjectionResponseKEY(e){return this.clientRoot.productProjections().withKey({key:e}).get({queryArgs:{staged:!0}}).execute()}}var o=r(1567),l=r(6249);var h=r(891);const p={Strings:{NO_DATA:{"en-US":"n/a",en:"n/a",ru:"н/д"},EMPTY_TEXT:{"en-US":"",en:"",ru:""}}};var u=r(928);class d extends u.Z{constructor(e,t){super({tag:o.Z.DIV,classNames:["product-card--s0pAM","product-card__link--bP6bY"],textContent:""}),this.URL_NO_IMAGE="",this.LANG="en-US",this.COUNTRY="US",this.creator=new l.Z,this.product=e,this.router=t,this.configView()}configView(){this.setRouteLink(),this.createProductView()}setRouteLink(){const e=`${h._.CATALOG}/${this.product.key}`;this.getElement().addEventListener("click",(()=>this.router.setHref(e)))}createProductView(){const e=this.getElement(),{masterVariant:t}=this.product,r=this.getImageElement(t),s=this.creator.createTagElement("div",["product-card__content-wrapper--QotyV"]);e.append(r,s);const i=this.getTitleElement(),a=this.getDescriptionElement(),n=this.getPricesElement(t);s.append(i,a,n)}getPricesElement(e){const t=this.creator.createTagElement("span",["product-card__prices-wrapper--bYEIR"]),r=this.getLocalPrices(e),s=this.creator.createTagElement("span",["product-card__price--CA0vt"],r.value);if(t.append(s),r.discount){s.classList.add("product-card__price_discounted--mwMfR");const e=this.creator.createTagElement("span",["product-card__discount--qqqII"],r.discount);t.append(e)}return t}getDescriptionElement(){const e=this.product.description?.[this.LANG]||p.Strings.EMPTY_TEXT[this.LANG];return this.creator.createTagElement("span",["product-card__description--umGvb"],e)}getTitleElement(){const e=this.product.name[this.LANG]||p.Strings.NO_DATA[this.LANG];return this.creator.createTagElement("span",["product-card__title--h2nFl"],e)}getImageElement(e){const t=e.images?e.images[0].url:this.URL_NO_IMAGE,r=this.creator.createTagElement("img",["product-card__image--ReLtA"]);return r.setAttribute("src",t),r}getLocalPrices(e){const t={value:"",discount:""},{prices:r}=e;if(r){const e=r.filter((e=>e.country===this.COUNTRY));if(e.length>0){const{value:r}=e[0];t.value=`${(r.centAmount/100).toFixed(r.fractionDigits)} ${r.currencyCode}`;const{discounted:s}=e[0];s?.value&&(t.discount=`${(s.value.centAmount/100).toFixed(s.value.fractionDigits)} ${s.value.currencyCode}`)}}return t}}var g=r(8624),E=r(7881),m=r(4296);class T{constructor(e,t){const r=new l.Z;this.element=r.createTagElement("label",["number-input__label--TBM3m"],e),this.input=r.createTagElement("input",["number-input--gINc4"]),this.input.setAttribute("type","number"),this.input.setAttribute("step","0.01"),this.element.setAttribute("placeholder",t||""),this.element.append(this.input)}getElement(){return this.element}set value(e){this.input.value=e}get value(){return this.input.value}setPlaceholder(e){this.element.setAttribute("placeholder",e)}}var f;!function(e){e.GENGE="genre",e.PLATFORM="Platform",e.DEVELOPER="developer"}(f||(f={}));const A=f;var P=r(213);class _{constructor(e,t,r){this.callback=r,this.element=(new l.Z).createTagElement("a",["filter-tag--f0cx7"],`${e}: ${t}`),this.element.addEventListener("click",this.clickHandler.bind(this))}getElement(){return this.element}clickHandler(){this.callback()}}class C extends u.Z{constructor(){super({tag:o.Z.DIV,classNames:["filter-header--ULKrZ"],textContent:""}),this.BUTTON_TEXT="Filter",this.tagWrapper=this.createTagWrapper(),this.observer=m.Z.getInstance(),this.configView()}configView(){const e=this.createFilterButton();this.getElement().append(e.getElement(),this.tagWrapper)}createTagWrapper(){return this.tagWrapper=(new l.Z).createTagElement("div",["filter-header__tag-wrapper--Zv2pn"]),this.tagWrapper}addFilterTag(e,t,r){const s=new _(e,t,r);this.tagWrapper.append(s.getElement())}clearFilterTags(){this.tagWrapper.replaceChildren("")}createFilterButton(){return new P.Z(this.BUTTON_TEXT,(()=>{this.observer.notify(E.Z.SHOW_FILTER)}))}}class w{constructor(e,t,r=(()=>{})){this.label=e,this.filters=t,this.callback=r;const s=new l.Z,i=s.createTagElement("label",["filter-checkbox__label--L72qn"],this.label);this.checkbox=s.createTagElement("input",["filter-checkbox--Ehil7"]),this.checkbox.setAttribute("type","checkbox"),t.includes(this.label)&&this.checkbox.setAttribute("checked",""),i.prepend(this.checkbox),this.element=i}getElement(){return this.element}updateSource(){const e=this.filters.indexOf(this.label);this.checkbox.checked&&e<0&&this.filters.push(this.label),!this.checkbox.checked&&e>=0&&this.filters.splice(e)}}const R="filter-popup__group--o_qHh",b="filter-popup__group-legend--Cm2NV";var D;!function(e){e.ENTER="Enter",e.NUMPAD_ENTER="NumpadEnter",e.ESC="Escape"}(D||(D={}));class v{constructor(e,t,r){this.filterInputs=[],this.BUTTON_APPLY_TEXT="Apply",this.PRICE_FILTER_TITLE="price",this.POPUP_TITLE="Filter",this.tagCreator=new l.Z,this.observer=m.Z.getInstance(),this.element=this.tagCreator.createTagElement("dialog",["filter-popup--FOGM1"]),this.filterUsed=t,this.filterData=e,this.priceGroup=r,this.configView(),this.configClosing()}getDialog(){return this.element}configView(){const e=this.tagCreator.createTagElement("div",["filter-popup__wrapper--cf0us"]),t=this.tagCreator.createTagElement("span",["filter-popup__title--_mmc9"],this.POPUP_TITLE);e.append(t),e.append(this.createGroupPrice()),e.append(this.createGroupGenre()),e.append(this.createGroupPlatform()),e.append(this.createGroupDeveloper());const r=this.createApplyButton();e.append(r.getElement());const s=this.createCloseButton();e.append(s),this.element.append(e)}createCloseButton(){const e=this.tagCreator.createTagElement("a",["filter-popup__close-icon--CenEx"]);return e.addEventListener("click",(()=>this.getDialog().remove())),e.setAttribute("tabindex","1"),e.setAttribute("autofocus",""),e}createApplyButton(){return new P.Z(this.BUTTON_APPLY_TEXT,(()=>{this.filterInputs.forEach((e=>e.updateSource())),this.observer.notify(E.Z.UPDATE_CATALOG_CARDS),this.observer.notify(E.Z.UPDATE_FILTER_TAGS),this.getDialog().remove()}))}createGroupDeveloper(){const e=this.tagCreator.createTagElement("fieldset",[R]),t=this.tagCreator.createTagElement("legend",[b],A.DEVELOPER);return e.append(t),this.filterData[A.DEVELOPER].forEach((t=>{const r=new w(t,this.filterUsed[A.DEVELOPER]);this.filterInputs.push(r),e.append(r.getElement())})),e}createGroupPlatform(){const e=this.tagCreator.createTagElement("fieldset",[R]),t=this.tagCreator.createTagElement("legend",[b],A.PLATFORM);return e.append(t),this.filterData[A.PLATFORM].forEach((t=>{const r=new w(t,this.filterUsed[A.PLATFORM]);this.filterInputs.push(r),e.append(r.getElement())})),e}createGroupPrice(){const e=this.tagCreator.createTagElement("fieldset",[R]),t=this.tagCreator.createTagElement("legend",[b],this.PRICE_FILTER_TITLE),r=this.tagCreator.createTagElement("div",["filter-popup__price-wrapper--dYS00"]);return r.append(this.priceGroup.minPrice.getElement(),this.priceGroup.maxPrice.getElement()),e.append(t,r),e}createGroupGenre(){const e=this.tagCreator.createTagElement("fieldset",[R]),t=this.tagCreator.createTagElement("legend",[b],A.GENGE);return e.append(t),this.filterData[A.GENGE].forEach((t=>{const r=new w(t,this.filterUsed[A.GENGE]);this.filterInputs.push(r),e.append(r.getElement())})),e}configClosing(){const e=this.onCloseDialog.bind(this);this.element.addEventListener("click",e),this.element.addEventListener("keydown",e)}onCloseDialog(e){e instanceof KeyboardEvent&&e.code===D.ESC&&this.element.remove(),e instanceof MouseEvent&&e.target instanceof HTMLDialogElement&&this.element.remove()}}class I{constructor(e){this.WRONG_PRICE_RANGE="Price filter didn't applied.\n Wrong price range: %MIN% to %MAX%",this.MIN_PRICE_TITLE="min",this.MAX_PRICE_TITLE="max",this.CURRENCY_FACTOR=100,this.filterData=this.getEmptyFilterArray(),this.filterUsed=this.getEmptyFilterArray(),this.filterPriceData=this.getEmptyPriceData(),this.filterHeader=new C,this.observer=m.Z.getInstance(),this.productApi=e,this.getFilterData(),this.createFilterTags(),this.observer.subscribe(E.Z.SHOW_FILTER,this.showFilterPopup.bind(this)),this.observer.subscribe(E.Z.UPDATE_FILTER_TAGS,this.createFilterTags.bind(this))}getFilterData(){this.productApi.getAllProducts().then((e=>{const{results:t}=e.body;t.forEach((e=>{const{attributes:t}=e.masterData.current.masterVariant;t&&t.forEach((e=>{e.name===A.GENGE&&this.filterData[A.GENGE].push(e.value[0].key),e.name===A.PLATFORM&&this.filterData[A.PLATFORM].push(e.value[0].key),e.name===A.DEVELOPER&&this.filterData[A.DEVELOPER].push(e.value[0])}))})),this.filterData.genre=Array.from(new Set(this.filterData.genre)),this.filterData.Platform=Array.from(new Set(this.filterData.Platform)),this.filterData.developer=Array.from(new Set(this.filterData.developer))})).catch((e=>(new g.Z).showMessage(e.message)))}getFilterHeaderElement(){return this.filterHeader.getCreator().getElement()}getEmptyPriceData(){return{minPrice:new T(this.MIN_PRICE_TITLE,""),maxPrice:new T(this.MAX_PRICE_TITLE,"")}}getEmptyFilterArray(){return{genre:[],Platform:[],developer:[]}}clearFilters(){this.filterUsed=this.getEmptyFilterArray(),this.filterPriceData=this.getEmptyPriceData(),this.createFilterTags()}showFilterPopup(){const e=new v(this.filterData,this.filterUsed,this.filterPriceData).getDialog();document.body.prepend(e),e.showModal()}createFilterTags(){this.filterHeader.clearFilterTags(),this.filterUsed.genre.forEach((e=>{this.filterHeader.addFilterTag(A.GENGE,e,this.deleteFilterTag.bind(this,this.filterUsed.genre,e))})),this.filterUsed.Platform.forEach((e=>{this.filterHeader.addFilterTag(A.PLATFORM,e,this.deleteFilterTag.bind(this,this.filterUsed.Platform,e))})),this.filterUsed.developer.forEach((e=>{this.filterHeader.addFilterTag(A.DEVELOPER,e,this.deleteFilterTag.bind(this,this.filterUsed.developer,e))}))}deleteFilterTag(e,t){const r=e.indexOf(t);r>=0&&e.splice(r,1),this.observer.notify(E.Z.UPDATE_CATALOG_CARDS),this.observer.notify(E.Z.UPDATE_FILTER_TAGS)}getFilterCondition(){return[this.getFilterForArrtibute(s.ENUM_ATTRIBUTE_MASK,A.GENGE),this.getFilterForArrtibute(s.ENUM_ATTRIBUTE_MASK,A.PLATFORM),this.getFilterForArrtibute(s.TEXT_ATTRIBUTE_MASK,A.DEVELOPER),this.getFilterForPrice(s.PRICE_FILTER_MASK)].filter((e=>e))}getFilterForPrice(e){const t=this.filterPriceData.minPrice.value||"0",r=this.filterPriceData.maxPrice.value||"0";return+t>+r||+t<0||+r<0?((new g.Z).showMessage(this.WRONG_PRICE_RANGE.replace("%MIN%",t).replace("%MAX%",r)),""):0==+t&&0==+r?"":(this.filterPriceData.minPrice.value=t,e.replace("%MIN%",(+t*this.CURRENCY_FACTOR).toString()).replace("%MAX%",(+r*this.CURRENCY_FACTOR).toString()))}getFilterForArrtibute(e,t){const r=[];return this.filterUsed[t].forEach((e=>r.push(`"${e}"`))),r.length>0?e.replace("%ATTRIBUTE%",t).replace("%VALUE%",r.join(",")):""}}var S,L;!function(e){e.ASC="▲",e.DESC="▼"}(S||(S={})),function(e){e[e.NAME_ASC=0]="NAME_ASC",e[e.NAME_DESC=1]="NAME_DESC",e[e.PRICE_ASC=2]="PRICE_ASC",e[e.PRICE_DESC=3]="PRICE_DESC"}(L||(L={}));class y extends u.Z{constructor(){super({tag:o.Z.DIV,classNames:["sort-header--Jog3u"],textContent:""}),this.sortCondition=L.NAME_ASC,this.observer=m.Z.getInstance(),this.options=[{title:`Name ${S.ASC}`,value:L.NAME_ASC,sortOrder:"name.en asc"},{title:`Name ${S.DESC}`,value:L.NAME_DESC,sortOrder:"name.en desc"},{title:`Price ${S.ASC}`,value:L.PRICE_ASC,sortOrder:"variants.scopedPrice.currentValue.centAmount asc"},{title:`Price ${S.DESC}`,value:L.PRICE_DESC,sortOrder:"variants.scopedPrice.currentValue.centAmount desc"}],this.sortList=this.createSortList(),this.configView()}configView(){this.sortList.addEventListener("change",this.sortHandler.bind(this)),this.getElement().append(this.sortList)}getSortCondition(){return this.options[this.sortList.selectedIndex].sortOrder}sortHandler(){this.observer.notify(E.Z.UPDATE_CATALOG_CARDS)}createSortList(){const e=new l.Z,t=e.createTagElement("select",["sort-header__list--SSlNO"]);return this.options.forEach((r=>{const s=e.createTagElement("option",["sort-header__option--MsrVg"],r.title);s.setAttribute("value",r.value.toString()),t.append(s)})),t}}class F{constructor(e){this.PLACEHOLDER="Ask me...",this.callback=e;const t=new l.Z;this.element=t.createTagElement("input",["search-input--pnryc"]),this.element.setAttribute("type","search"),this.element.setAttribute("placeholder",this.PLACEHOLDER),this.element.addEventListener("search",(()=>e()))}getElement(){return this.element}clear(){this.element.value=""}getSearchString(){return this.element.value.trim()}}var M=r(22);class N extends u.Z{constructor(e){super({tag:o.Z.SECTION,classNames:["catalog-view--MIS7q"],textContent:""}),this.LANG="en-US",this.COUNTRY="US",this.NOT_FOUND="Products not found",this.productApi=new c,this.observer=m.Z.getInstance(),this.filter=new I(this.productApi),this.search=new F(this.getSearchProducts.bind(this)),this.sorting=new y,this.router=e,this.observer.subscribe(E.Z.UPDATE_CATALOG_CARDS,this.recallProductCards.bind(this)),this.controlsWrapper=(new l.Z).createTagElement("div",["controls-wrapper--gM5pc"]),this.cardsWrapper=(new l.Z).createTagElement("div",["content-wrapper--zfsyF"]),this.getCreator().addInnerElement(this.cardsWrapper),this.configView()}recallProductCards(){this.search.clear(),this.getProducts()}getCategories(){this.productApi.getCategories().then((e=>e))}configView(){const e=this.filter.getFilterHeaderElement(),t=this.sorting.getElement();this.controlsWrapper.append(e,this.search.getElement(),t),this.getElement().append(this.controlsWrapper,this.cardsWrapper),this.getProducts()}getSearchProducts(){const e=this.search.getSearchString();if(e){const t=this.getSearchQueryParams(e);this.productApi.getProducts(t).then((e=>{const t=e.body.results;t.length?(this.filter.clearFilters(),this.createProductCards(t)):(new M.Z).showMessage(this.NOT_FOUND)})).catch((e=>(new g.Z).showMessage(e.message)))}else this.getProducts()}getProducts(){const e=this.getQueryParams();this.productApi.getProducts(e).then((e=>{const t=e.body.results;this.createProductCards(t),t.length||(new M.Z).showMessage(this.NOT_FOUND)})).catch((e=>(new g.Z).showMessage(e.message)))}getQueryParams(){const e={fuzzy:!1,priceCountry:"US",priceCurrency:"USD",markMatchingVariants:!0,sort:this.sorting.getSortCondition()},t=this.filter.getFilterCondition();t.length&&(e.filter=t);const r=this.sorting.getSortCondition();return r&&(e.sort=r),e}getSearchQueryParams(e){return{"text.en":e,fuzzy:!0,priceCountry:"US",priceCurrency:"USD",markMatchingVariants:!0}}createProductCards(e){this.cardsWrapper.replaceChildren(""),e.forEach((e=>{if(e.key){const t=new d(e,this.router);this.cardsWrapper.append(t.getElement())}}))}}}}]);