"use strict";(self.webpackChunkecommerce_application=self.webpackChunkecommerce_application||[]).push([[812],{3226:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(9367);class a extends i.Z{constructor(){super(i.C.Info)}}},22:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(9367);class a extends i.Z{constructor(){super(i.C.Warning)}}},213:(e,t,s)=>{s.d(t,{Z:()=>h});const i="link-button_disabled--Dp40F",a="selected--MHVHa",n="hide--dDtEv";var r=s(928),o=s(1567),l=s(891);class h extends r.Z{constructor(e,t,s){super({tag:o.Z.A,textContent:e,classNames:["link-button--QFx_T"]}),this.linksGroup=s,this.getElement().addEventListener("click",t),this.configView()}configView(){this.getElement().addEventListener("click",(()=>{this.markSelected()})),this.viewForLoggedUser()}markSelected(){this.linksGroup&&(this.linksGroup.forEach((e=>{e.markUnSelected()})),this.getElement().classList.add(a))}markUnSelected(){this.getElement().classList.remove(a)}hideButton(){this.getElement().classList.add(n)}disableButton(){this.getElement().classList.add(i)}enableButton(){this.getElement().classList.remove(i)}showButton(){this.getElement().classList.remove(n)}viewForLoggedUser(){"true"===localStorage.getItem("isLogin")&&this.linksGroup&&(this.linksGroup.get(l.bm.REGISTRATION)?.disableButton(),this.linksGroup.get(l.bm.LOGIN)?.disableButton())}}},7105:(e,t,s)=>{s.r(t),s.d(t,{default:()=>q});const i={wrap:"wrap--DHYWB"};var a,n=s(1567),r=s(6249),o=s(4602),l=s(891),h=s(213),d=s(928);!function(e){e.ADD_SHIPPING_ADDRESS_BUTTON="add shipping address",e.ADD_BILLING_ADDRESS_BUTTON="add billing address",e.DELETE_ADDRESS_BUTTON="delete this address",e.MAKE_ADDRESS_SHIPPING_BUTTON="make this address shipping",e.MAKE_ADDRESS_BILLING_BUTTON="make this address billing",e.MAKE_ADDRESS_SHIPPING_DEFAULT_BUTTON="make this address default shipping",e.MAKE_ADDRESS_BILLING_DEFAULT_BUTTON="make this address default billing",e.TITLE_ADDRESS_SHIPPING="shipping address",e.TITLE_ADDRESS_BILLING="billing address",e.DEFAULT_ADDRESS_SHIIPPING="default shipping",e.DEFAULT_ADDRESS_BILLING="default billling",e.REDACTION_MODE_BUTTON="edit",e.CONFIRM_BUTTON="confirm",e.CANCEL_BUTTON="cancel",e.CONFIRM_MESSAGE_INFO="new data successfully saved",e.CANCEL_MESSAGE_INFO="modifications have been canceled",e.CHANGE_COUNTRY_INFO="Don't forget to change the postal code according to the selected country",e.COUNTRY_CHANGING_OK="data successfully changed",e.CHANGE_PASSWORD="change password",e.CHANGE_PASSWORD_INFO_IS_OK="password successfully changed",e.ADD_ADRESS_OK="the address was successfully added",e.CHANGE_ADRESS_OK="the address was successfully changed",e.VALIDATE_INPUT_BEFORE_SUBMIT="Make sure you fill out your account correctly",e.VALIDATE_FORM_BEFORE_SUBMIT="Make sure you fill out all fields correctly",e.NEW_PASSWORD_FIELD_LABEL="enter the new password",e.REPEAT_NEW_PASSWORD_FIELD_LABEL="repeat the new password",e.OLD_PASSWORD_FIELD_LABEL="enter the existing password"}(a||(a={}));const u=a;var c=s(4296),g=s(7881),p=s(2953),E=s(5246),m=s(4957);const A={"field-group":"field-group--magme"},C={"field-view":"field-view--kJ8a8"},D={active:"active--GNwPO"},I={"redaction-button":"redaction-button--gfaO6"};var S=s(5311),_=s(22),w=s(8624),B=s(3226);const N={button:"button--p_MbL"};class f{constructor(e,t,s,i){this.textContent=e,this.classList=t,this.eventListener=s,this.event=i,this.button=this.createButton()}getButton(){return this.button}createButton(){const e=document.createElement(n.Z.BUTTON);return e.textContent=this.textContent,e.classList.add(...Object.values(N)),this.classList&&e.classList.add(...this.classList),this.eventListener&&this.event&&e.addEventListener(this.event,this.eventListener),e}}var L,T=s(5476);!function(e){e.EMAIL_ADDRESS="email",e.FIRST_NAME="firstName",e.LAST_NAME="lastName",e.DATE_OF_BIRTH="dateOfBirth"}(L||(L={}));const F=L;var O=s(4218),b=s(8717);class v{constructor(e,t){this.api=t,this.elementField=this.createElementField(),this.inputElement=new T.Z(e.inputParams),this.value=e.value,this.labelValue=e.inputParams.attributes.placeholder,this.action=e.action,this.actionName=e.actionName,this.id=e.id,this.cancelButton=this.createCancelButton(),this.confirmButton=this.createConfirmButton(),this.redactionModeButton=this.createRedactionModeButton(),this.configureView()}getElement(){return this.elementField}getInputElement(){return this.inputElement}getConfirmButton(){return this.confirmButton}createElementField(){const e=document.createElement(n.Z.DIV);return e.classList.add(...Object.values(C)),e}configureView(){this.configureInputElement(),this.elementField.append(this.inputElement.getElement(),this.redactionModeButton)}configureInputElement(){this.inputElement.setDisabled(),this.inputElement.setInputValue(this.value),this.inputElement.setLabel(this.labelValue),this.inputElement.removeMessageElement()}createRedactionModeButton(){return this.createButton(u.REDACTION_MODE_BUTTON,Object.values(I),this.redactionModeHandler.bind(this),S.Z.CLICK)}createConfirmButton(){return this.createButton(u.CONFIRM_BUTTON,Object.values(I),this.saveValueHandler.bind(this),S.Z.CLICK)}createCancelButton(){return this.createButton(u.CANCEL_BUTTON,Object.values(I),this.cancelValueHandler.bind(this),S.Z.CLICK)}createButton(e,t,s,i){return new f(e,t,s,i).getButton()}showInfoMessage(e){(new B.Z).showMessage(e)}showErrorMessage(e){(new w.Z).showMessage(e)}showWarningMessage(e){(new _.Z).showMessage(e)}redactionModeHandler(){this.value=this.inputElement.getInputValue(),this.inputElement.appendMessage(),this.elementField.removeChild(this.redactionModeButton),this.inputElement.removeDisabled(),this.elementField.append(this.confirmButton,this.cancelButton),this.elementField.classList.add(...Object.values(D))}saveValueHandler(){[b.I$.EMAIL,b.I$.FIRST_NAME,b.I$.LAST_NAME,`${b.I$.DATE_OF_BIRTH}. ${b.WA.DATE_OF_BIRTH_HINT}`].includes(this.labelValue)&&(this.value=this.inputElement.getInputValue(),this.inputElement.getInput().checkValidity()?(this.exitEditModeChangeButton(),this.saveValue()):this.showWarningMessage(u.VALIDATE_INPUT_BEFORE_SUBMIT))}cancelValueHandler(){this.exitEditModeChangeButton(),this.inputElement.setInputValue(this.value),this.showInfoMessage(u.CANCEL_MESSAGE_INFO)}exitEditModeChangeButton(){this.inputElement.setDisabled(),this.elementField.removeChild(this.confirmButton),this.elementField.removeChild(this.cancelButton),this.inputElement.removeMessageElementFromLabel(),this.elementField.append(this.redactionModeButton),this.elementField.classList.remove(...Object.values(D))}saveValue(){this.api.getRegApi().getCustomer(window.localStorage.getItem(p.Z.MAIL_ADDRESS)).then((e=>{this.api.getRegApi().changeData(this.id,e.body.results[0].version,this.action,this.actionName,this.value).then((e=>{this.actionName===F.EMAIL_ADDRESS&&window.localStorage.setItem(p.Z.MAIL_ADDRESS,this.value),e.statusCode===O.Z.USER_VALUE_CHANGED&&this.showInfoMessage(u.CONFIRM_MESSAGE_INFO)})).catch((e=>{this.showErrorMessage(e.message)}))})).catch((e=>{this.showErrorMessage(e.message)}))}}class R{constructor(e,t){this.api=t,this.mainFieldGroup=this.createMainFieldGroupElement(),this.userFieldsProps=e,this.userFieldElements=this.createUserFieldsElements(),this.configureView()}getElement(){return this.mainFieldGroup}configureView(){this.mainFieldGroup.append(...this.userFieldElements)}createMainFieldGroupElement(){const e=document.createElement(n.Z.DIV);return e.classList.add(...Object.values(A)),e}createUserFieldsElements(){const e=[];return this.userFieldsProps.forEach((t=>{const s=new v(t,this.api);e.push(s.getElement())})),e}}const M={"button-wrap":"button-wrap--IOykP"},y={description:"description--hPbg6"};var P;!function(e){e[e.ID=0]="ID",e[e.STREET=1]="STREET",e[e.POSTAL=2]="POSTAL",e[e.CITY=3]="CITY",e[e.COUNTRY=4]="COUNTRY"}(P||(P={}));const H=P;var Z,V=s(423),G=s(2123);class U{constructor(e,t){this.observer=c.Z.getInstance(),this.api=t,this.deleteAddressButton=this.createDeleteButton(),this.makeShippingDefaultButton=this.createMakeDefaultShippingButton(),this.makeBillingDefaultButton=this.createMakeDefaultBillingButton(),this.makeShippingButton=this.createMakeShippingButton(),this.makeBillingButton=this.createMakeBillingButton(),this.addressGroup=this.createAddressFieldGroupElement(),this.countryOptions=new E.Z,this.inputsParams=new m.Z,this.values=this.createValues(e),this.streetField=this.createStreetField(),this.cityField=this.createCityField(),this.postalField=this.createPostalField(),this.countryField=this.createCountryField(),this.confirmButtons=this.createConfirmButtons(),this.configureConfirmButtons(),this.fields=[this.streetField,this.cityField,this.postalField,this.countryField],this.countryField.getElement().addEventListener(S.Z.CHANGE,this.validateCountryListHandler.bind(this)),this.countryField.getElement().addEventListener("change",this.changeCountryHandler.bind(this)),this.buttonWrap=this.configureButtons(e),this.configureView(e)}getElement(){return this.addressGroup}configureView(e){this.addressGroup.append(this.createDescription(e),this.streetField.getElement(),this.cityField.getElement(),this.postalField.getElement(),this.countryField.getElement(),this.buttonWrap,this.countryOptions.getListElement())}createConfirmButtons(){return[this.streetField.getConfirmButton(),this.cityField.getConfirmButton(),this.postalField.getConfirmButton(),this.countryField.getConfirmButton()]}configureConfirmButtons(){this.confirmButtons.forEach((e=>e.addEventListener(S.Z.CLICK,this.confirmHandler.bind(this))))}createValues(e){return[e.id,e.streetName,e.postalCode,e.city,e.country]}createAddressFieldGroupElement(){const e=document.createElement(n.Z.DIV);return e.classList.add(...Object.values(A)),e}createStreetField(){const e=this.values[H.STREET],t={id:this.values[H.ID],action:"",actionName:"",value:e,inputParams:this.inputsParams.getStreetParams()};return new v(t,this.api)}createCityField(){const e=this.values[H.CITY],t={id:this.values[H.ID],action:"",actionName:"",value:e,inputParams:this.inputsParams.getCityParams()};return new v(t,this.api)}createPostalField(){const e=this.values[H.POSTAL],t={id:this.values[H.ID],action:"",actionName:"",value:e,inputParams:this.inputsParams.getSPostalParams()};return new v(t,this.api)}createCountryField(){const e=this.countryOptions.getCountryByCode(this.values[H.COUNTRY]),t={id:this.values[H.ID],action:"",actionName:"",value:e,inputParams:this.inputsParams.getCountryParams()};return new v(t,this.api)}createDescription(e){const t=document.createElement(n.Z.DIV);return t.classList.add(...Object.values(y)),e.isShining&&t.append(this.createTitle(u.TITLE_ADDRESS_SHIPPING)),e.isBilling&&t.append(this.createTitle(u.TITLE_ADDRESS_BILLING)),e.isDefaultShipping&&t.append(this.createTitle(u.DEFAULT_ADDRESS_SHIIPPING)),e.isDefaultBilling&&t.append(this.createTitle(u.DEFAULT_ADDRESS_BILLING)),t}createTitle(e){const t=document.createElement("h3");return t.textContent=e,t}changeCountryHandler(){this.showInfoMessage(u.CHANGE_COUNTRY_INFO)}validateCountryListHandler(){const e=this.countryOptions.getCountryList(),t=this.countryField.getInputElement(),s=this.postalField.getInputElement(),i=t.getInputValue();e.flat().includes(i)?(this.changePostalPatternWithCountry(s,e,i),t.setCustomValidity("")):(t.setCustomValidity(b.WA.COUNTRY_HINT),this.changePostalPatternWithOutCountry(s))}changePostalPatternWithCountry(e,t,s){t.forEach(((t,i)=>{if(t.includes(s)){const t=Array.from(Object.values(V.Z))[i];e.setPattern(t);const a=Array.from(Object.values(G.Z))[i],n=`${s.slice(0,-3)}\`s postal ${a}`;e.setTitle(n),e.setMessageError(n),e.setCustomValidity("")}}))}changePostalPatternWithOutCountry(e){e.setTitle(b.WA.WRONG_COUNTRY),e.setMessageError(b.WA.WRONG_COUNTRY),e.setCustomValidity(b.WA.WRONG_COUNTRY)}showInfoMessage(e){(new B.Z).showMessage(e)}confirmHandler(){this.isCheckValidityForm()?this.showWarningMessage(u.VALIDATE_FORM_BEFORE_SUBMIT):this.api.getRegApi().getCustomer(window.localStorage.getItem(p.Z.MAIL_ADDRESS)).then((e=>{this.api.getRegApi().changeAddress(e.body.results[0].id,e.body.results[0].version,this.values[H.ID],this.streetField.getInputElement().getInputValue(),this.postalField.getInputElement().getInputValue(),this.cityField.getInputElement().getInputValue(),this.countryField.getInputElement().getInputValue().slice(-2)).catch((e=>{e instanceof Error&&this.showErrorMessage(e.message)}))})).then((()=>{this.fields.forEach((e=>{e.getElement().classList.contains(D.active)&&(e.exitEditModeChangeButton(),this.showInfoMessage(u.COUNTRY_CHANGING_OK))}))})).catch((e=>{"The anonymousId is already in use."===e.message?this.confirmHandler():this.showErrorMessage(e.message)}))}showErrorMessage(e){(new w.Z).showMessage(e)}showWarningMessage(e){(new _.Z).showMessage(e)}isCheckValidityForm(){let e=!0;return this.streetField.getInputElement().getInput().checkValidity()&&this.postalField.getInputElement().getInput().checkValidity()&&this.cityField.getInputElement().getInput().checkValidity()&&this.countryField.getInputElement().getInput().checkValidity()&&(e=!1),e}createMakeDefaultShippingButton(){return this.createButtons(u.MAKE_ADDRESS_SHIPPING_DEFAULT_BUTTON,this.makeDefaulShippingtHandler.bind(this),S.Z.CLICK)}makeDefaulShippingtHandler(){this.api.getRegApi().getCustomer(window.localStorage.getItem(p.Z.MAIL_ADDRESS)).then((e=>{this.api.getRegApi().makeAddressShippingDefault(e.body.results[0].id,e.body.results[0].version,this.values[H.ID]).then((e=>{e.statusCode===O.Z.USER_VALUE_CHANGED&&this.observer.notify(g.Z.ADDRESS_CHANGED)})).catch((e=>{this.showErrorMessage(e)}))})).catch((e=>{"The anonymousId is already in use."===e.message?this.makeDefaulShippingtHandler():this.showErrorMessage(e.message)}))}createMakeDefaultBillingButton(){return this.createButtons(u.MAKE_ADDRESS_BILLING_DEFAULT_BUTTON,this.makeDefaultBillingHandler.bind(this),S.Z.CLICK)}makeDefaultBillingHandler(){this.api.getRegApi().getCustomer(window.localStorage.getItem(p.Z.MAIL_ADDRESS)).then((e=>{this.api.getRegApi().makeAddressBillingDefault(e.body.results[0].id,e.body.results[0].version,this.values[H.ID]).then((e=>{e.statusCode===O.Z.USER_VALUE_CHANGED&&this.observer.notify(g.Z.ADDRESS_CHANGED)})).catch((e=>{e instanceof Error&&this.showErrorMessage(e.message)}))})).catch((e=>{e instanceof Error&&this.showErrorMessage(e.message)}))}createDeleteButton(){return this.createButtons(u.DELETE_ADDRESS_BUTTON,this.deleteAdressButtonHAndler.bind(this),S.Z.CLICK)}deleteAdressButtonHAndler(){this.api.getRegApi().getCustomer(window.localStorage.getItem(p.Z.MAIL_ADDRESS)).then((e=>{this.api.getRegApi().deleteAdress(e.body.results[0].id,e.body.results[0].version,this.values[H.ID]).then((e=>{e.statusCode===O.Z.USER_VALUE_CHANGED&&this.observer.notify(g.Z.ADDRESS_CHANGED)})).catch((e=>{this.showErrorMessage(e)}))})).catch((e=>{"The anonymousId is already in use."===e.message?this.deleteAdressButtonHAndler():this.showErrorMessage(e.message)}))}createMakeShippingButton(){return this.createButtons(u.MAKE_ADDRESS_SHIPPING_BUTTON,this.makeShippingtHandler.bind(this),S.Z.CLICK)}makeShippingtHandler(){this.api.getRegApi().getCustomer(window.localStorage.getItem(p.Z.MAIL_ADDRESS)).then((e=>{this.api.getRegApi().makeAddressShipping(e.body.results[0].id,e.body.results[0].version,this.values[H.ID]).then((e=>{e.statusCode===O.Z.USER_VALUE_CHANGED&&this.observer.notify(g.Z.ADDRESS_CHANGED)})).catch((e=>{this.showErrorMessage(e)}))})).catch((e=>{this.showErrorMessage(e)}))}createMakeBillingButton(){return this.createButtons(u.MAKE_ADDRESS_BILLING_BUTTON,this.makeBillingHandler.bind(this),S.Z.CLICK)}makeBillingHandler(){this.api.getRegApi().getCustomer(window.localStorage.getItem(p.Z.MAIL_ADDRESS)).then((e=>{this.api.getRegApi().makeAddressBilling(e.body.results[0].id,e.body.results[0].version,this.values[H.ID]).then((e=>{e.statusCode===O.Z.USER_VALUE_CHANGED&&this.observer.notify(g.Z.ADDRESS_CHANGED)})).catch((e=>{this.showErrorMessage(e)}))})).catch((e=>{"The anonymousId is already in use."===e.message?this.makeBillingHandler():this.showErrorMessage(e.message)}))}createButtons(e,t,s){return new f(e,Object.values(I),t,s).getButton()}configureButtons(e){const t=document.createElement(n.Z.DIV);return t.classList.add(...Object.values(M)),t.append(this.deleteAddressButton,this.makeShippingButton,this.makeBillingButton,this.makeShippingDefaultButton,this.makeBillingDefaultButton),e.isShining&&t.removeChild(this.makeShippingButton),e.isBilling&&t.removeChild(this.makeBillingButton),e.isDefaultShipping&&t.removeChild(this.makeShippingDefaultButton),e.isDefaultBilling&&t.removeChild(this.makeBillingDefaultButton),t}}!function(e){e.CHANGE_EMAIL_ADDRESS="changeEmail",e.CHANGE_FIRST_NAME="setFirstName",e.CHANGE_LAST_NAME="setLastName",e.CHANGE_DATE_OF_BIRTH="setDateOfBirth"}(Z||(Z={}));const k=Z,W={"password-changer":"password-changer--dPVTA"},K={"password-field":"password-field--fp0Qg"},j={"password-wrap":"password-wrap--tJPSS"};class x{constructor(e,t){this.api=t,this.parentElement=e,this.passwordChangerElement=this.createPasswordChangerElement(),this.inputParamsCreator=new m.Z,this.newPasswordField=this.createPasswordField(this.inputParamsCreator.getPasswordParams(),u.NEW_PASSWORD_FIELD_LABEL),this.repeatPasswordField=this.createPasswordField(this.inputParamsCreator.getPasswordRepeatParams(),u.REPEAT_NEW_PASSWORD_FIELD_LABEL),this.confirmOldPasswordField=this.createPasswordField(this.inputParamsCreator.getPasswordParams(),u.OLD_PASSWORD_FIELD_LABEL),this.buttonCancel=this.createButtonCancel(),this.buttonConfirm=this.createButtonConfirm(),this.configureView()}configureView(){this.repeatPasswordField.getInput().addEventListener(S.Z.CHANGE,this.passwordCheckHandler.bind(this)),this.newPasswordField.getInput().addEventListener(S.Z.CHANGE,this.passwordCheckHandler.bind(this)),this.passwordChangerElement.addEventListener(S.Z.CLICK,this.goOutFromRedactionHandler.bind(this));const e=this.createWrap();e.append(this.newPasswordField.getElement(),this.repeatPasswordField.getElement(),this.confirmOldPasswordField.getElement(),this.buttonConfirm,this.buttonCancel),this.passwordChangerElement.append(e)}createWrap(){const e=document.createElement(n.Z.DIV);return e.classList.add(...Object.values(j)),e}getPasswordChanger(){return this.passwordChangerElement}createPasswordChangerElement(){const e=document.createElement(n.Z.DIV);return e.classList.add(...Object.values(W)),e}createPasswordField(e,t){const s=e,i=new T.Z(s);i.getElement().classList.add(...Object.values(K));const a=this.createSubTitle(t);return i.getElement().prepend(a),i}createSubTitle(e){const t=document.createElement("h3");return t.classList.add(...Object.values(K)),t.textContent=e,t}passwordCheckHandler(){const e=this.repeatPasswordField;this.newPasswordField.getInputValue()===e.getInputValue()?(e.setCustomValidity(""),e.removeMessage()):(e.setMessageError(b.WA.PASSWORD_REPEAT),e.setCustomValidity(b.WA.PASSWORD_REPEAT))}createButtonConfirm(){return this.createButtons(u.CONFIRM_BUTTON,this.confirmHandler.bind(this),S.Z.CLICK)}createButtonCancel(){return this.createButtons(u.CANCEL_BUTTON,this.cancelHandler.bind(this),S.Z.CLICK)}createButtons(e,t,s){return new f(e,void 0,t,s).getButton()}cancelHandler(){this.parentElement.removeChild(this.passwordChangerElement)}confirmHandler(){this.isCheckValidityForm()?this.showWarningMessage(u.VALIDATE_FORM_BEFORE_SUBMIT):this.changePassword()}showWarningMessage(e){(new _.Z).showMessage(e)}showInfoMessage(e){(new B.Z).showMessage(e)}showErrorMessage(e){(new w.Z).showMessage(e)}goOutFromRedactionHandler(e){e.target===this.passwordChangerElement&&this.cancelHandler()}changePassword(){this.api.getRegApi().getCustomer(window.localStorage.getItem(p.Z.MAIL_ADDRESS)).then((e=>{this.api.getRegApi().changePassword(e.body.results[0].id,this.newPasswordField.getInputValue(),this.confirmOldPasswordField.getInputValue(),e.body.results[0].version).then((e=>{e.statusCode===O.Z.USER_VALUE_CHANGED&&(this.showInfoMessage(u.CHANGE_PASSWORD_INFO_IS_OK),this.cancelHandler())})).catch((e=>{this.showErrorMessage(e.message)}))})).catch((e=>{this.showErrorMessage(e.message)}))}isCheckValidityForm(){let e=!0;return this.newPasswordField.getInput().checkValidity()&&this.confirmOldPasswordField.getInput().checkValidity()&&this.repeatPasswordField.getInput().checkValidity()&&(e=!1),e}}var Y=s(6193);class ${constructor(e,t,s){this.observer=c.Z.getInstance(),this.api=s,this.isShiping=t,this.isDefault=!1,this.countryOptions=new E.Z,this.parentElement=e,this.adressChangerElement=this.createAddressGroupElement(),this.inputParamsCreator=new m.Z,this.streetField=this.createField(this.inputParamsCreator.getStreetParams(),b.I$.STREET),this.cityField=this.createField(this.inputParamsCreator.getCityParams(),b.I$.CITY),this.postalField=this.createField(this.inputParamsCreator.getSPostalParams(),b.I$.POSTAL),this.countryField=this.createField(this.inputParamsCreator.getCountryParams(),b.I$.COUNTRY),this.buttonCancel=this.createButtonCancel(),this.buttonConfirm=this.createButtonConfirm(),this.buttonDefault=this.createButtonDefault(),this.configureView()}configureView(){this.countryField.getInput().addEventListener(S.Z.CHANGE,this.validateCountryListHandler.bind(this)),this.adressChangerElement.addEventListener(S.Z.CLICK,this.goOutFromRedactionHandler.bind(this));const e=this.createWrap();e.append(this.buttonDefault,this.streetField.getElement(),this.cityField.getElement(),this.postalField.getElement(),this.countryField.getElement(),this.countryOptions.getListElement(),this.buttonConfirm,this.buttonCancel),this.adressChangerElement.append(e)}createWrap(){const e=document.createElement(n.Z.DIV);return e.classList.add(...Object.values(j)),e}getElement(){return this.adressChangerElement}createAddressGroupElement(){const e=document.createElement(n.Z.DIV);return e.classList.add(...Object.values(W)),e}createField(e,t){const s=e,i=new T.Z(s);i.getElement().classList.add(...Object.values(K));const a=this.createSubTitle(t);return i.getElement().prepend(a),i}createSubTitle(e){const t=document.createElement("h3");return t.classList.add(...Object.values(K)),t.textContent=e,t}validateCountryListHandler(){const e=this.countryOptions.getCountryList(),t=this.countryField,s=this.postalField,i=t.getInputValue();e.flat().includes(i)?(this.changePostalPatternWithCountry(s,e,i),t.setCustomValidity("")):(t.setCustomValidity(b.WA.COUNTRY_HINT),this.changePostalPatternWithOutCountry(s))}changePostalPatternWithCountry(e,t,s){t.forEach(((t,i)=>{if(t.includes(s)){const t=Array.from(Object.values(V.Z))[i];e.setPattern(t);const a=Array.from(Object.values(G.Z))[i],n=`${s.slice(0,-3)}\`s postal ${a}`;e.setTitle(n),e.setMessageError(n),e.setCustomValidity("")}}))}changePostalPatternWithOutCountry(e){e.setTitle(b.WA.WRONG_COUNTRY),e.setMessageError(b.WA.WRONG_COUNTRY),e.setCustomValidity(b.WA.WRONG_COUNTRY)}createButtonConfirm(){return this.createButtons(u.CONFIRM_BUTTON,this.confirmHandler.bind(this),S.Z.CLICK)}createButtonCancel(){return this.createButtons(u.CANCEL_BUTTON,this.cancelHandler.bind(this),S.Z.CLICK)}createButtonDefault(){return this.createButtons(Y.Z.BUTTON_DEFAULT,this.defaultHandler.bind(this),S.Z.CLICK)}createButtons(e,t,s){return new f(e,void 0,t,s).getButton()}cancelHandler(){this.parentElement.removeChild(this.adressChangerElement)}confirmHandler(){this.isCheckValidityForm()?this.showWarningMessage(u.VALIDATE_FORM_BEFORE_SUBMIT):this.changeAdress()}defaultHandler(){this.isDefault?(this.isDefault=!1,this.buttonDefault.textContent=Y.Z.BUTTON_DEFAULT):(this.isDefault=!0,this.buttonDefault.textContent=Y.Z.BUTTON_UN_DEFAULT)}showWarningMessage(e){(new _.Z).showMessage(e)}showInfoMessage(e){(new B.Z).showMessage(e)}showErrorMessage(e){(new w.Z).showMessage(e)}goOutFromRedactionHandler(e){e.target===this.adressChangerElement&&this.cancelHandler()}changeAdress(){this.api.getRegApi().getCustomer(window.localStorage.getItem(p.Z.MAIL_ADDRESS)).then((e=>{this.api.getRegApi().addAddress(e.body.results[0].id,e.body.results[0].version,this.streetField.getInputValue(),this.postalField.getInputValue(),this.cityField.getInputValue(),this.countryField.getInputValue().slice(-2)).then((e=>{if(e.statusCode===O.Z.USER_VALUE_CHANGED)return{id:e.body.addresses[e.body.addresses.length-1].id,version:e.body.version,statusCode:e.statusCode}})).then((t=>(void 0!==t&&(this.isShiping?this.api.getRegApi().makeAddressShipping(e.body.results[0].id,t.version,t.id).then((e=>{this.isDefault&&this.api.getRegApi().makeAddressShippingDefault(e.body.id,e.body.version,e.body.addresses[e.body.addresses.length-1].id).catch((e=>{this.showErrorMessage(e)}))})).catch((e=>{this.showErrorMessage(e)})):this.api.getRegApi().makeAddressBilling(e.body.results[0].id,t.version,t.id).then((e=>{this.isDefault&&this.api.getRegApi().makeAddressBillingDefault(e.body.id,e.body.version,e.body.addresses[e.body.addresses.length-1].id).catch((e=>{this.showErrorMessage(e)}))})).catch((e=>{this.showErrorMessage(e)}))),t))).then((e=>{e.statusCode===O.Z.USER_VALUE_CHANGED&&this.observer.notify(g.Z.ADDRESS_ADDED)})).catch((e=>{this.showErrorMessage(e.message)}))})).catch((e=>{"The anonymousId is already in use."===e.message?this.changeAdress():this.showErrorMessage(e.message)}))}isCheckValidityForm(){let e=!0;return this.streetField.getInput().checkValidity()&&this.postalField.getInput().checkValidity()&&this.cityField.getInput().checkValidity()&&this.countryField.getInput().checkValidity()&&(e=!1),e}}class q extends d.Z{constructor(e,t){super({tag:n.Z.SECTION,classNames:["profile-view--tXFs_"],textContent:""}),this.observer=c.Z.getInstance(),this.api=t.api,this.router=e,this.emailAddress=window.localStorage.getItem(p.Z.MAIL_ADDRESS),this.countryOptions=new E.Z,this.wrapper=(new r.Z).createTagElement("div",Object.values(i)),this.getCreator().addInnerElement(this.wrapper),this.userData=this.request(),this.configView(),this.observer.subscribe(g.Z.LOGIN,this.login.bind(this)),this.observer.subscribe(g.Z.LOGOUT,this.logoutListener.bind(this)),this.observer.subscribe(g.Z.ADDRESS_CHANGED,this.addressChangedHandler.bind(this)),this.observer.subscribe(g.Z.ADDRESS_ADDED,this.addressAddHandler.bind(this))}setContent(e){this.wrapper.replaceChildren(""),e instanceof o.Z?this.wrapper.append(e.getElement()):this.wrapper.append(e)}configView(){this.createContent()}addressChangedHandler(){this.userData=this.request(),this.showInfoMessage(u.CHANGE_ADRESS_OK)}addressAddHandler(){this.userData=this.request(),this.showInfoMessage(u.ADD_ADRESS_OK)}login(){this.emailAddress=window.localStorage.getItem(p.Z.MAIL_ADDRESS),this.userData=this.request()}logoutListener(){this.wrapper.textContent="";const e=this.createMainButton();this.wrapper.append(e.getElement())}createContent(){this.wrapper.textContent="";const e=this.createMainButton();e.getElement().classList.add(...Object.values(I));const t=this.createButton(u.CHANGE_PASSWORD,this.goToPasswordChangerHandler.bind(this),S.Z.CLICK),s=new f(u.ADD_SHIPPING_ADDRESS_BUTTON,Object.values(I),this.addShippingAddressHandler.bind(this),S.Z.CLICK),a=new f(u.ADD_BILLING_ADDRESS_BUTTON,Object.values(I),this.addBillingAddressHandler.bind(this),S.Z.CLICK);this.wrapper.append(e.getElement(),t,s.getButton(),a.getButton());const n=this.createUserField(),o=(new r.Z).createTagElement("div",Object.values(i)),l=this.createAddressGroup(this.userData.addresses);o.append(n,...l),this.wrapper.append(o)}createMainButton(){return new h.Z(l.bm.INDEX,(()=>{this.router.setHref(l._.INDEX)}))}request(){const e=this.createUserData(),t=this.emailAddress;return t&&this.api.getRegApi().getCustomer(t).then((t=>{const s=t.body.results[0];return null!=s.id&&(e.id=s.id),null!=s.version&&(e.version=s.version),null!=s.firstName&&(e.firstName=s.firstName),null!=s.lastName&&(e.lastName=s.lastName),null!=s.dateOfBirth&&(e.dateOfBirth=s.dateOfBirth),e.addresses=this.createAddresses(s.addresses,s.shippingAddressIds,s.billingAddressIds,s.defaultShippingAddressId,s.defaultBillingAddressId),e})).then((()=>this.configView())).catch((e=>{"The anonymousId is already in use."===e.message?this.userData=this.request():this.showErrorMessage(e.message)})),e}createAddressGroup(e){const t=[];return e.forEach((e=>{const s=new U(e,this.api);t.push(s.getElement())})),t}createAddresses(e,t,s,i,a){const n=[];return e.forEach((e=>{void 0!==e.id&&(void 0!==t&&t.includes(e.id)&&(e.isShining=!0),void 0!==s&&s.includes(e.id)&&(e.isBilling=!0),void 0!==i&&i===e.id&&(e.isDefaultShipping=!0),void 0!==a&&a===e.id&&(e.isDefaultBilling=!0)),n.push(e)})),n}createMainProps(){const e=new m.Z;return[{id:this.userData.id,action:k.CHANGE_EMAIL_ADDRESS,actionName:F.EMAIL_ADDRESS,value:this.emailAddress,inputParams:e.getMailParams()},{id:this.userData.id,action:k.CHANGE_FIRST_NAME,actionName:F.FIRST_NAME,value:this.userData.firstName,inputParams:e.getFirstNameParams()},{id:this.userData.id,action:k.CHANGE_LAST_NAME,value:this.userData.lastName,actionName:F.LAST_NAME,inputParams:e.getLastNameParams()},{id:this.userData.id,action:k.CHANGE_DATE_OF_BIRTH,value:this.userData.dateOfBirth,actionName:F.DATE_OF_BIRTH,inputParams:e.getDateParams()}]}createButton(e,t,s){return new f(e,Object.values(I),t,s).getButton()}createUserData(){const e="unassigned";return{id:e,version:0,firstName:e,lastName:e,dateOfBirth:e,shippingAddresses:[{city:e,country:e,id:e,postalCode:e,streetName:e,isDefaultShipping:!1,isDefaultBilling:!1,isShining:!1,isBilling:!1}],billingAddresses:[{city:e,country:e,id:e,postalCode:e,streetName:e,isDefaultShipping:!1,isDefaultBilling:!1,isShining:!1,isBilling:!1}],addresses:[{city:e,country:e,id:e,postalCode:e,streetName:e,isDefaultShipping:!1,isDefaultBilling:!1,isShining:!1,isBilling:!1}]}}createUserField(){const e=this.createMainProps();return new R(e,this.api).getElement()}goToPasswordChangerHandler(){const e=new x(this.wrapper,this.api);this.wrapper.append(e.getPasswordChanger())}addShippingAddressHandler(){const e=new $(this.wrapper,!0,this.api);this.wrapper.append(e.getElement())}addBillingAddressHandler(){const e=new $(this.wrapper,!1,this.api);this.wrapper.append(e.getElement())}showInfoMessage(e){(new B.Z).showMessage(e)}showErrorMessage(e){(new w.Z).showMessage(e)}}}}]);