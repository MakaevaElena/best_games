"use strict";(self.webpackChunkecommerce_application=self.webpackChunkecommerce_application||[]).push([[106],{7106:(t,e,s)=>{s.r(e),s.d(e,{default:()=>O});var i=s(1567),a=s(4602),n=s(928);const l={"login-view":"login-view--xYXHF","registration-field":"registration-field--rfaSb","login-title":"login-title--ZnrER","registration-field__title":"registration-field__title--IH0AX","login-subtitle":"login-subtitle--Bhb9b","login-form":"login-form--JFEMt","login-form__show-password":"login-form__show-password--r1rU6","login-form__field":"login-form__field--HsqZS","password-block":"password-block--dqC0n",button:"button--KUb8s"};var o=s(4296),r=s(7881),m=s(891),d=s(2953),E=s(8624),h=s(5233),c=s(7683);const g=/(?=.*[0-9])/g,u=/(?=.*[a-z])/,w=/(?=.*[A-Z])/,_=/(?=.*[!@#$%^&*])/,p=/[0-9a-zA-Z!@#$%^&*]{8,}/,I=/^\s|\s$/,N=/[a-z0-9]+[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}/;var S;!function(t){t.FILL_EMAIL="Please fill the field email.",t.FILL_PASSWORD="Please fill the field password.",t.MAIL_NOT_REGISTERED="This email address has not been registered.",t.SUCCESS_LOGIN="Welcome! You are logged!.",t.PASSWORD_IS_WRONG="Password is wrong!",t.EMAIL_CONTAIN_WHITESPACE="Email address must not contain leading or trailing whitespace.",t.EMAIL_WRONG_FORMAT="Email address must be properly formatted (e.g., user@example.com).",t.PASSWORD_CONTAIN_WHITESPACE="Password must not contain leading or trailing whitespace.",t.PASSWORD_NOT_CONTAIN_DIGIT="Password must contain at least one digit (0-9).",t.PASSWORD_NOT_CONTAIN_LOWER_LETTER="Password must contain at least one lowercase letter (a-z).",t.PASSWORD_NOT_CONTAIN_UPPER_LETTER="Password must contain at least one uppercase letter (A-Z).",t.PASSWORD_NOT_CONTAIN_SIMBOLS="Password must contain at least one special character (e.g., !@#$%^&*).",t.PASSWORD_LENGTH_NOT_ENOUTH="Password must be at least 8 characters long."}(S||(S={}));class O extends n.Z{constructor(t,e){super({tag:i.Z.SECTION,classNames:[l["login-view"]],textContent:""}),this.loginEmail=new a.Z({tag:i.Z.INPUT,classNames:[l["login-form__field"]],textContent:"email"}),this.loginPassword=new a.Z({tag:i.Z.INPUT,classNames:[l["login-form__field"]],textContent:"password"}),this.passwordElement=this.loginPassword.getElement(),this.emailElement=this.loginEmail.getElement(),this.observer=o.Z.getInstance(),this.router=t,this.api=e.api,this.observer.subscribe(r.Z.LOGOUT,this.logout.bind(this)),"true"===localStorage.getItem("isLogin")?this.router.setHref(m._.INDEX):this.configView()}configView(){this.renderForm()}logout(){this.getCreator().clearInnerContent(),this.configView();const t=(0,c.Z)();this.api.recreate(t)}renderForm(){const t=new a.Z({tag:i.Z.SPAN,classNames:[l["login-title"]],textContent:"EXISTING CUSTOMERS"}),e=new a.Z({tag:i.Z.SPAN,classNames:[l["login-subtitle"]],textContent:"Sign Into Best Games"}),s=new a.Z({tag:i.Z.DIV,classNames:[l["login-form"]],textContent:""}),n=new a.Z({tag:i.Z.DIV,classNames:[l["password-block"]],textContent:""}),o=new a.Z({tag:i.Z.BUTTON,classNames:[l.button,l["login-form__show-password"]],textContent:"SHOW"}),r=new a.Z({tag:i.Z.BUTTON,classNames:[l.button],textContent:"LOG IN"}),d=new a.Z({tag:i.Z.DIV,classNames:[l["registration-field"]],textContent:""}),E=new a.Z({tag:i.Z.SPAN,classNames:[l["registration-field__title"]],textContent:"NEW CUSTOMERS"}),h=new a.Z({tag:i.Z.BUTTON,classNames:[l["register-link"],l.button],textContent:"REGISTER NOW"});s.getElement().setAttribute("action","#"),this.emailElement.setAttribute("type","email"),this.emailElement.setAttribute("name","email"),this.emailElement.setAttribute("placeholder","email"),this.emailElement.setAttribute("Required","true"),this.passwordElement.setAttribute("type","password"),this.passwordElement.setAttribute("name","password"),this.passwordElement.setAttribute("placeholder","password"),this.passwordElement.setAttribute("Required","true"),this.emailElement.addEventListener("input",(()=>this.validateEmail())),this.passwordElement.addEventListener("input",(()=>this.validatePassword())),o.getElement().addEventListener("click",(t=>this.showPassword(t))),r.getElement().addEventListener("click",(t=>this.submitLogin(t))),h.getElement().addEventListener("click",(()=>{this.router.setHref(m._.REGISTRATION)})),s.addInnerElement(t),s.addInnerElement(e),s.addInnerElement(this.loginEmail),n.addInnerElement(this.loginPassword),n.addInnerElement(o),s.addInnerElement(n),s.addInnerElement(r),d.addInnerElement(E),d.addInnerElement(h),this.getCreator().addInnerElement(s),this.getCreator().addInnerElement(d)}showPassword(t){t.preventDefault(),"password"===this.passwordElement.getAttribute("type")?this.passwordElement.setAttribute("type","text"):this.passwordElement.setAttribute("type","password")}async submitLogin(t){t.preventDefault();const e=this.emailElement.value,s=this.passwordElement.value;if(e||(this.emailElement.setCustomValidity(S.FILL_EMAIL),this.emailElement.reportValidity()),s||(this.passwordElement.setCustomValidity(S.FILL_PASSWORD),this.passwordElement.reportValidity()),0!==e.length&&0!==s.length&&this.validatePassword()&&this.validateEmail()){if(void 0!==e)try{if(0===(await this.api.getClientApi().checkCustomerExist(e)).body.results.length)return this.emailElement.setCustomValidity(S.MAIL_NOT_REGISTERED),void this.emailElement.reportValidity()}catch(t){t instanceof Error&&(new E.Z).showMessage(t.message)}const t=localStorage.getItem(d.Z.ANONYMOUS_ID);t&&this.api.getClientApi().loginCustomer({email:e,password:s},t).then((t=>{if(t.body.customer){window.localStorage.setItem("isLogin","true"),window.localStorage.setItem(d.Z.MAIL_ADDRESS,e),this.router.setHref(m._.INDEX);const i=(0,h.Z)(e,s);this.api.recreate(i);const a=t.body.customer.id;localStorage.setItem(d.Z.CUSTOMER_ID,a),localStorage.setItem(d.Z.ANONYMOUS_ID,""),this.observer.notify(r.Z.LOGIN)}})).catch((()=>{this.passwordElement.setCustomValidity(S.PASSWORD_IS_WRONG),this.passwordElement.reportValidity()}))}}validateEmail(){const{value:t}=this.emailElement;switch(this.emailElement.setCustomValidity(""),!0){case I.test(t):case t.indexOf(" ")>-1:this.emailElement.setCustomValidity(S.EMAIL_CONTAIN_WHITESPACE);break;case!N.test(t):this.emailElement.setCustomValidity(S.EMAIL_WRONG_FORMAT);break;default:return this.emailElement.setCustomValidity(""),!0}return this.emailElement.reportValidity(),!1}validatePassword(){const{value:t}=this.passwordElement;switch(this.passwordElement.setCustomValidity(""),!0){case I.test(t):this.passwordElement.setCustomValidity(S.PASSWORD_CONTAIN_WHITESPACE);break;case!g.test(t):this.passwordElement.setCustomValidity(S.PASSWORD_NOT_CONTAIN_DIGIT);break;case!u.test(t):this.passwordElement.setCustomValidity(S.PASSWORD_NOT_CONTAIN_LOWER_LETTER);break;case!w.test(t):this.passwordElement.setCustomValidity(S.PASSWORD_NOT_CONTAIN_UPPER_LETTER);break;case!_.test(t):this.passwordElement.setCustomValidity(S.PASSWORD_NOT_CONTAIN_SIMBOLS);break;case!p.test(t):this.passwordElement.setCustomValidity(S.PASSWORD_LENGTH_NOT_ENOUTH);break;default:return this.passwordElement.setCustomValidity(""),!0}return this.passwordElement.reportValidity(),!1}}}}]);