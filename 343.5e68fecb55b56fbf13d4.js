"use strict";(self.webpackChunkecommerce_application=self.webpackChunkecommerce_application||[]).push([[343],{3226:(t,e,a)=>{a.d(e,{Z:()=>r});var n=a(9367);class r extends n.Z{constructor(){super(n.C.Info)}}},343:(t,e,a)=>{a.r(e),a.d(e,{default:()=>C});var n=a(1567),r=a(6249),o=a(4602),s=a(928);const i={"cart-view":"cart-view--NG6pU","content-wrapper":"content-wrapper--sTIw_","cart-section":"cart-section--tJdJo","cart-header":"cart-header--laEwz","cart-header__image":"cart-header__image--qW_VY","cart-header__title":"cart-header__title--RqNcm","cart-header__quantity":"cart-header__quantity--Lv1Ap","cart-header__order-value":"cart-header__order-value--UeTX8","cart-cell":"cart-cell--nzjIP","cart-items-wrapper":"cart-items-wrapper--xEcRr","item-block":"item-block--fYn1k","item-block__image":"item-block__image--fPQMh","item-block__info-block":"item-block__info-block--FcSkx","item-block__name":"item-block__name--zeSeB","item-block__details":"item-block__details--b90Nk","item-block__remove-button":"item-block__remove-button--s7G3x","item-block__quantity":"item-block__quantity--JwIvp","item-block__quantity-input":"item-block__quantity-input--xXFHp","item-block__quantity-minus":"item-block__quantity-minus--S2G6v","item-block__quantity-plus":"item-block__quantity-plus--NgTpE","item-block__order-value":"item-block__order-value--KByrB","cart-total-cost":"cart-total-cost--RCw43","cart-promo":"cart-promo--NxKK4","cart-total-cost__old":"cart-total-cost__old--YPO4I","cart-promo__old":"cart-promo__old--k6mF3","cart-total-cost__title":"cart-total-cost__title--cPKPK","cart-promo__title":"cart-promo__title--ouqso","cart-total-cost__value":"cart-total-cost__value--X_EDi","cart-promo__value":"cart-promo__value--ScNtb","cart-total-cost__input-box":"cart-total-cost__input-box--oPKo6","cart-promo__input-box":"cart-promo__input-box--TlXxI","cart-total-cost__input":"cart-total-cost__input--ax1Z3","cart-promo__input":"cart-promo__input--HqNjG","cart-total-cost__apply-button-box":"cart-total-cost__apply-button-box--IxuzL","cart-promo__apply-button-box":"cart-promo__apply-button-box--UPweR","link-button":"link-button--WF17r","cart-total-cost__disabled":"cart-total-cost__disabled--ltOcs","cart-promo__disabled":"cart-promo__disabled--XjiSD","cart-empty":"cart-empty--JL0cv","cart-empty__tytle":"cart-empty__tytle--hIJDg","cart-empty__first-text":"cart-empty__first-text--E9aZt","cart-empty__second-text":"cart-empty__second-text--bEA3D","cart-empty__row-image":"cart-empty__row-image--jzkL8","cart-empty__image":"cart-empty__image--fpoeO"};var c=a(8624),l=a(891),m=a(3226),d=a(2953),_=a(4296),u=a(7881);function p(t,e){let a;return a&&clearTimeout(a),function(){a=setTimeout((()=>t()),e)}}class h extends s.Z{constructor(t,e,a){super({tag:n.Z.SECTION,classNames:[i["cart-view"]],textContent:""}),this.observer=_.Z.getInstance(),this.api=a,this.itemsWrapper=e,this.router=t}createCartItem(t,e){this.api.getClientApi().productProjectionResponseKEY(t).then((async a=>{const s=a.body.masterVariant,c=new o.Z({tag:n.Z.SECTION,classNames:[i["item-block"]],textContent:""}),m=new o.Z({tag:n.Z.DIV,classNames:[i["item-block__image"],i["cart-cell"]],textContent:""});s.images&&(m.getElement().style.backgroundImage=`url(${s.images?.[0].url})`);const d=new o.Z({tag:n.Z.DIV,classNames:[i["item-block__info-block"],i["cart-cell"]],textContent:""}),_=new o.Z({tag:n.Z.DIV,classNames:[i["item-block__name"]],textContent:`${a.body.name.en}`}),u=new o.Z({tag:n.Z.SPAN,classNames:[i["item-block__details"]],textContent:"More details"});u.getElement().addEventListener("click",(()=>{const e=`${l._.CATALOG}/${t}`;this.router.setHref(e)}));const h=new o.Z({tag:n.Z.DIV,classNames:[i["item-block__order-summ"]],textContent:""}),g=new o.Z({tag:n.Z.DIV,classNames:[i["item-block__quantity"],i["cart-cell"]],textContent:""}),C=(new r.Z).createTagElement("input",[i["item-block__quantity-input"],i["cart-cell"]]);C.setAttribute("readonly","readonly");const I=new o.Z({tag:n.Z.DIV,classNames:[i["item-block__quantity-minus"],i["cart-cell"]],textContent:"-"}),b=new o.Z({tag:n.Z.DIV,classNames:[i["item-block__quantity-plus"],i["cart-cell"]],textContent:"+"});I.getElement().addEventListener("click",p((async()=>{Number(C.value)>1&&(C.value=(Number(C.value)-1).toString(),await this.changeQuantityItem(t,Number(C.value)).then((async()=>{h.getElement().textContent=`${this.getItemSum(a,C.value)}`})))}),1e3)),b.getElement().addEventListener("click",p((async()=>{C.value=(Number(C.value)+1).toString(),await this.changeQuantityItem(t,Number(C.value)).then((async()=>{h.getElement().textContent=`${this.getItemSum(a,C.value)}`}))}),800)),C.setAttribute("type","number"),C.setAttribute("min","1"),C.setAttribute("value","1"),C.value=`${e[0].quantity}`,C.addEventListener("change",p((async()=>{this.changeQuantityItem(t,Number(C.value)).then((async()=>{h.getElement().textContent=`${this.getItemSum(a,C.value)}`}))}),800));const y=new o.Z({tag:n.Z.DIV,classNames:[i["item-block__order-value"],i["cart-cell"]],textContent:""});h.getElement().textContent=`${this.getItemSum(a,C.value)}`;const E=new o.Z({tag:n.Z.SPAN,classNames:[i["item-block__remove-button"]],textContent:"Remove Item"});E.getElement().addEventListener("click",(()=>{this.removeItemFromCart(a),this.itemsWrapper.getElement().removeChild(c.getElement())})),c.addInnerElement(m),d.addInnerElement(_),d.addInnerElement(u),c.addInnerElement(d),g.addInnerElement(I),g.addInnerElement(C),g.addInnerElement(b),c.addInnerElement(g),y.addInnerElement(h),y.addInnerElement(E),c.addInnerElement(y),this.itemsWrapper.addInnerElement(c.getElement())}))}getItemSum(t,e){return t.body.masterVariant.prices?.[1].discounted?.value?`PRICE: ${(Number(t.body.masterVariant.prices?.[1].discounted?.value.centAmount)/100*Number(e)).toFixed(2)} ${t.body.masterVariant.prices?.[1].discounted?.value.currencyCode}`:t.body.masterVariant.prices?.[1].value?`PRICE: ${(Number(t.body.masterVariant.prices?.[1].value?.centAmount)/100*Number(e)).toFixed(2)} ${t.body.masterVariant.prices?.[1].value?.currencyCode}`:""}removeItemFromCart(t){this.api.getClientApi().getActiveCart().then((async e=>{const a=e.body.id;localStorage.setItem(d.Z.ANONIM_CART_ID,a);const n=e.body.lineItems.filter((e=>e.productKey===t.body.key));n[0].id&&this.api.getClientApi().removeLineItem(a,e.body.version,n[0].id).then((()=>{this.observer.notify(u.Z.TOTAL_COST_CHANGED),(new m.Z).showMessage("Item removed from cart"),this.observer.notify(u.Z.UPDATE_CART)})).catch((t=>(new c.Z).showMessage(t.message)))})).catch((t=>(new c.Z).showMessage(t.message)))}async changeQuantityItem(t,e){this.api.getClientApi().getActiveCart().then((async a=>{const n=a.body.lineItems.filter((e=>e.productKey===t));return this.api.getClientApi().changeQuantityByLineID(a.body.id,a.body.version,n[0].id,e).then((t=>{200===t.statusCode&&(this.observer.notify(u.Z.TOTAL_COST_CHANGED),this.observer.notify(u.Z.UPDATE_CART))})).catch((t=>(new c.Z).showMessage(t.message))),e})).catch((t=>(new c.Z).showMessage(t.message)))}}var g=a(213);class C extends s.Z{constructor(t,e){super({tag:n.Z.SECTION,classNames:[i["cart-view"]],textContent:""}),this.observer=_.Z.getInstance(),this.cartSection=new o.Z({tag:n.Z.SECTION,classNames:[i["cart-section"]],textContent:""}),this.orderTotalCost=new o.Z({tag:n.Z.DIV,classNames:[i["cart-total-cost__value"]],textContent:""}),this.totalCost=new o.Z({tag:n.Z.DIV,classNames:[i["cart-total-cost"]],textContent:""}),this.itemsWrapper=new o.Z({tag:n.Z.DIV,classNames:[i["cart-items-wrapper"]],textContent:""}),this.anonimCartID=localStorage.getItem(d.Z.ANONIM_CART_ID),this.api=e.api,this.router=t,this.wrapper=(new r.Z).createTagElement("div",[i["content-wrapper"]]),this.cartItem=new h(t,this.itemsWrapper,this.api),this.observer.subscribe(u.Z.TOTAL_COST_CHANGED,this.updateTotalSumm.bind(this)),this.getCreator().addInnerElement(this.wrapper),this.anonimCartID||this.createAnonimCart(),this.configView()}configView(){const t=localStorage.getItem(d.Z.ANONIM_CART_ID);t?this.api.getClientApi().getCartByCartID(t).then((t=>{const e=t.body.id;return localStorage.setItem(d.Z.ANONIM_CART_ID,e),t.body.lineItems.length>0?(this.createCartHeader(),t.body.lineItems.forEach((async e=>{const a=t.body.lineItems.filter((t=>t.productKey===e.productKey));e.productKey&&await this.cartItem.createCartItem(e.productKey,a)}))):this.showEmptyCart(),t})).then((t=>(t.body.lineItems.length>0&&(this.cartSection.addInnerElement(this.itemsWrapper),this.createPromo(t),this.updateTotalSumm()),this.wrapper.append(this.cartSection.getElement()),t))).then((t=>{this.createClearCartButton(t)})).catch((t=>(new c.Z).showMessage(t.message))):this.showEmptyCart()}createClearCartButton(t){if(t.body.lineItems.length>0){const t=new g.Z("CLEAR CART",this.clearCart.bind(this));this.cartSection.addInnerElement(t.getElement())}}clearCart(){this.api.getClientApi().getActiveCart().then((t=>{const{id:e,version:a}=t.body;this.api.getClientApi().deleteCustomerCart(e,a).then((()=>{localStorage.setItem(d.Z.ANONIM_CART_ID,""),this.observer.notify(u.Z.UPDATE_CART),this.showEmptyCart()}))})).catch((t=>{t instanceof Error&&(new c.Z).showMessage(t.message)}))}removeItem(t){t.productKey&&this.removeProductHandler(t.id)}showEmptyCart(){this.cartSection.getElement().innerHTML="";const t=new o.Z({tag:n.Z.DIV,classNames:[i["cart-empty"]],textContent:""}),e=new o.Z({tag:n.Z.DIV,classNames:[i["cart-empty__tytle"]],textContent:"Your cart is still empty!"}),a=new o.Z({tag:n.Z.DIV,classNames:[i["cart-empty__image"]],textContent:""}),r=new o.Z({tag:n.Z.DIV,classNames:[i["cart-empty__first-text"]],textContent:"Exciting games are here"}),s=new o.Z({tag:n.Z.DIV,classNames:[i["cart-empty__row-image"]],textContent:""}),c=new g.Z(l.bm.CATALOG,(()=>{this.router.navigate(l._.CATALOG)})),m=new o.Z({tag:n.Z.DIV,classNames:[i["cart-empty__second-text"]],textContent:"What are you waiting for?\n                  ...Christmas?"});t.addInnerElement(e),t.addInnerElement(a),t.addInnerElement(r),t.addInnerElement(s),t.addInnerElement(c.getElement()),t.addInnerElement(m),this.cartSection.addInnerElement(t)}createCartHeader(){const t=new o.Z({tag:n.Z.DIV,classNames:[i["cart-header"]],textContent:""}),e=new o.Z({tag:n.Z.DIV,classNames:[i["cart-header__image"],i["cart-cell"]],textContent:""}),a=new o.Z({tag:n.Z.DIV,classNames:[i["cart-header__title"],i["cart-cell"]],textContent:"Items"}),r=new o.Z({tag:n.Z.DIV,classNames:[i["cart-header__quantity"],i["cart-cell"]],textContent:"Quantity"}),s=new o.Z({tag:n.Z.DIV,classNames:[i["cart-header__order-value"],i["cart-cell"]],textContent:"Order Value"});t.addInnerElement(e),t.addInnerElement(a),t.addInnerElement(r),t.addInnerElement(s),this.cartSection.addInnerElement(t)}createTotalOrderValue(t,e){this.totalCost.getElement().innerHTML="",this.totalCost.getElement().remove();const a=new o.Z({tag:n.Z.DIV,classNames:[i["cart-total-cost__title"]],textContent:"TOTAL COST: "}),r=new o.Z({tag:n.Z.DIV,classNames:[i["cart-total-cost__old"]],textContent:`${e}`});this.orderTotalCost.getElement().textContent=`${t}`,this.totalCost.addInnerElement(a),e!==t&&this.totalCost.addInnerElement(r),this.totalCost.addInnerElement(this.orderTotalCost),this.cartSection.addInnerElement(this.totalCost),t&&"0.00 USD"!==t||this.showEmptyCart()}createPromo(t){this.totalCost.getElement().innerHTML="",this.totalCost.getElement().remove();const e=new o.Z({tag:n.Z.DIV,classNames:[i["cart-promo"]],textContent:""}),a=new o.Z({tag:n.Z.DIV,classNames:[i["cart-promo__title"]],textContent:"PROMO CODE: "}),s=new o.Z({tag:n.Z.DIV,classNames:[i["cart-promo__input-box"]],textContent:""}),c=(new r.Z).createTagElement("input",[i["cart-promo__input"]]);c.setCustomValidity("");const l=new o.Z({tag:n.Z.DIV,classNames:[i["cart-promo__apply-button-box"],i.button],textContent:""}),m=new g.Z("Apply PROMO",(()=>{this.getPromoCodes().then((t=>{c instanceof HTMLInputElement&&t.includes(c.value)?(this.applyPromo(c.value),m.disableButton(),m.getElement().textContent="PROMO applied"):(c.setCustomValidity("Incorrect PROMO code"),c.reportValidity())})),c.value||(c.setCustomValidity("Enter the PROMO code"),c.reportValidity())}));t.body.discountCodes.length>0&&(m.disableButton(),m.getElement().textContent="PROMO applied"),e.addInnerElement(a),s.addInnerElement(c),e.addInnerElement(s),l.addInnerElement(m.getElement()),e.addInnerElement(l),this.cartSection.addInnerElement(e)}async getPromoCodes(){const t=[];return await this.api.getClientApi().getPromoCodes().then((e=>{e.body.results.forEach((e=>{t.push(`${e.code}`)}))})).catch((t=>{t instanceof Error&&(new c.Z).showMessage(t.message)})),t}setContent(t){this.getCreator().clearInnerContent(),this.getCreator().addInnerElement(t)}applyPromo(t){this.api.getClientApi().getActiveCart().then((e=>{const a=e.body.id;localStorage.setItem(d.Z.ANONIM_CART_ID,a),this.api.getClientApi().updateCartWithDiscount(a,e.body.version,t).then((()=>{this.updateTotalSumm(),this.observer.notify(u.Z.UPDATE_CART)})).catch((t=>{t instanceof Error&&(new c.Z).showMessage(t.message)}))}))}updateTotalSumm(){this.api.getClientApi().getActiveCart().then((t=>{const e=t.body.id;localStorage.setItem(d.Z.ANONIM_CART_ID,e);const a=`${(Number(t.body.totalPrice.centAmount)/100).toFixed(2)} ${t.body.totalPrice.currencyCode}`;let n=0;t.body.lineItems.forEach((t=>{n+=Number(t.price.value.centAmount)*t.quantity})),this.createTotalOrderValue(a,`${(n/100).toFixed(2)} ${t.body.totalPrice.currencyCode}`)})).catch((t=>{t instanceof Error&&(new c.Z).showMessage(t.message)}))}createAnonimCart(){localStorage.getItem(d.Z.ANONIM_CART_ID)||this.api.getClientApi().createCustomerCart().then((t=>{localStorage.setItem(d.Z.ANONIM_CART_ID,`${t.body.id}`),this.configView()})).catch((t=>{t instanceof Error&&(new c.Z).showMessage(t.message)}))}removeProductHandler(t){this.api.getClientApi().getActiveCart().then((e=>{const a=e.body.id;this.removeProductFromCart(a,t,e.body.version),localStorage.setItem(d.Z.ANONIM_CART_ID,a)})).catch((t=>{t instanceof Error&&(new c.Z).showMessage(t.message)}))}removeProductFromCart(t,e,a){this.api.getClientApi().removeLineItem(t,a,e).then((()=>{this.observer.notify(u.Z.REMOVE_FROM_CART),this.observer.notify(u.Z.UPDATE_CART)})).catch((t=>{t instanceof Error&&(new c.Z).showMessage(t.message)}))}}}}]);