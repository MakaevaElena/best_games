"use strict";(self.webpackChunkecommerce_application=self.webpackChunkecommerce_application||[]).push([[260],{5429:(t,e,i)=>{i.d(e,{Z:()=>l});var s=i(3037),n=i(7683),r=i(5233),a=i(9909);class l{constructor(t){if(this.clientRoot=(0,s.mv)((0,n.p0)()).withProjectKey({projectKey:"best-games"}),this.addItemToCartByID=(t,e,i)=>this.clientRoot.carts().withId({ID:t}).post({body:{version:e,actions:[{action:"addLineItem",sku:i}]}}).execute(),t){const e=(0,r.r4)(t.email,t.password);this.clientRoot=(0,s.mv)(e).withProjectKey({projectKey:"best-games"})}}checkCustomerExist(t){return this.returnCustomerByEmail(t).then((t=>t))}returnCustomerByEmail(t){return this.clientRoot.customers().get({queryArgs:{where:`email="${t}"`}}).execute()}getCustomerByID(t){return this.clientRoot.customers().get({queryArgs:{where:`id="${t}"`}}).execute()}getCustomer({email:t,password:e}){return this.clientRoot.me().login().post({body:{email:t,password:e,updateProductData:!0}}).execute()}createUserRoot(t,e){const i=(0,r.r4)(t,e);return this.clientRoot=(0,s.mv)(i).withProjectKey({projectKey:"best-games"}),this.clientRoot}getCategory(t){return this.clientRoot.categories().withId({ID:t}).get().execute()}createCustomerDraft(t){const{email:e,password:i,firstName:s,lastName:n,countryCode:r,key:a}=t;return{email:e,password:i,key:a,firstName:s,lastName:n,addresses:[{country:r}],defaultShippingAddress:0}}createCustomer(t){try{return this.clientRoot.customers().post({body:this.createCustomerDraft(t)}).execute()}catch(t){return t}}getProducts(){return this.clientRoot.products().get().execute()}getProductbyID(t){return this.clientRoot.products().withId({ID:t}).get().execute()}getProductbyKey(t){return this.clientRoot.products().withKey({key:t}).get().execute()}productProjectionResponseID(t){return this.clientRoot.productProjections().withId({ID:t}).get({queryArgs:{staged:!0}}).execute()}productProjectionResponseKEY(t){return this.clientRoot.productProjections().withKey({key:t}).get({queryArgs:{staged:!0}}).execute()}getCartByCustomerId(t){return this.clientRoot.carts().withCustomerId({customerId:t}).get().execute()}getCartByCartID(t){return this.clientRoot.carts().withId({ID:t}).get().execute()}createCart(){return this.clientRoot.carts().post({body:{key:`cart-key-${a.Z.newGuid()}`,currency:"USD",country:"US"}}).execute()}}},5448:(t,e,i)=>{i.r(e),i.d(e,{default:()=>R});const s="registrationView__inputsGroup--s2afB",n="registrationView__form--yXlDY",r="registrationView__defaultSelect--za2h9";var a,l=i(1567),o=i(8717),u=i(5476),d=i(928),h=i(5311);!function(t){t.SUBMIT="submit",t.BUTTON="button"}(a||(a={}));const c=a;var p;!function(t){t[t.EMAIL=0]="EMAIL",t[t.PASSWORD=1]="PASSWORD",t[t.REPEAT_PASSWORD=2]="REPEAT_PASSWORD",t[t.FIRST_NAME=3]="FIRST_NAME",t[t.LAST_NAME=4]="LAST_NAME",t[t.DATE_OF_BIRTH=5]="DATE_OF_BIRTH",t[t.SHIPPING_STREET=6]="SHIPPING_STREET",t[t.SHIPPING_CITY=7]="SHIPPING_CITY",t[t.SHIPPING_POSTAL=8]="SHIPPING_POSTAL",t[t.SHIPPING_COUNTRY=9]="SHIPPING_COUNTRY",t[t.BILLING_STREET=10]="BILLING_STREET",t[t.BILLING_CITY=11]="BILLING_CITY",t[t.BILLING_POSTAL=12]="BILLING_POSTAL",t[t.BILLING_COUNTRY=13]="BILLING_COUNTRY"}(p||(p={}));const g=p;var I,m=i(423),A=i(2123),S=i(6193),L=i(4121),E=i(891),T=i(5429),C=i(7881),_=i(4296);!function(t){t[t.SWITCH_TO_PAGE=2e3]="SWITCH_TO_PAGE"}(I||(I={}));const P=I;var N=i(4218),D=i(2953),y=i(5246),B=i(4957);class R extends d.Z{constructor(t){super({tag:l.Z.SECTION,classNames:["registrationView--n6v1f"],textContent:""}),this.router=t,this.observer=_.Z.getInstance(),this.mainInputsGroup=this.fillInputsGroups(this.createMainParams()),this.shippingInputsGroup=this.fillInputsGroups(this.createShippingAddressParams()),this.billingInputsGroup=this.fillInputsGroups(this.createBillingAddressParams()),this.inputs=[...this.mainInputsGroup,...this.shippingInputsGroup,...this.billingInputsGroup],this.checkValidityElement=this.createValidMessageElement(),this.buttonDefaultShippingAddress=this.createDefaultButton(S.Z.BUTTON_DEFAULT,[r]),this.buttonDefaultBillingAddress=this.createDefaultButton(S.Z.BUTTON_DEFAULT,[r]),this.buttonAddAddress=this.createDefaultButton(S.Z.REMOVE_BILLING_ADDRESS,["registrationView__buttonAddAdsress--xXsVy"]),this.billingLabel=this.createLabel(o.Yk.BILLING_ADDRESS),this.shippingLabel=this.createLabel(o.Yk.SHIPPING_ADDRESS),this.isDefaultShippingAddress=!1,this.isDefaultBillingAddress=!1,this.isBillingAddress=!0,this.countryOption=new y.Z,this.countryList=this.countryOption.getListElement(),this.configView()}configView(){const t=this.createTitle(),e=this.createDescription(),i=this.createForm(),s=document.createElement(l.Z.BUTTON);s.textContent=S.Z.TO_LOGIN,s.classList.add("button--pcOys"),s.addEventListener(h.Z.CLICK,this.redirectLoginhandler.bind(this)),this.buttonAddAddress.addEventListener(h.Z.CLICK,this.toggleBillingAddressHandler.bind(this)),this.getElement().append(t,e,s,i,this.buttonAddAddress,this.countryList)}redirectLoginhandler(){this.router.navigate(E._.LOGIN)}createValidMessageElement(){const t=document.createElement(l.Z.DIV);return t.textContent=S.Z.CHECK_VALIDITY,t.classList.add("registrationView__checkValidity--z5NU8"),t.addEventListener(h.Z.CLICK,this.removeValidityMessageHandler.bind(this)),t}removeValidityMessageHandler(){this.checkValidityElement.textContent=S.Z.CHECK_VALIDITY,this.getElement().removeChild(this.checkValidityElement)}createLabel(t){const e=document.createElement("label");return e.textContent=t,e.classList.add(s),e}createTitle(){const t=document.createElement("h1");return t.classList.add("registrationView__tittle--nXz7b"),t.textContent=S.Z.TITLE,t}createDescription(){const t=document.createElement("p");return t.classList.add("registrationView__description--qhfiP"),t.textContent=S.Z.DESCRIPTION,t}fillInputsGroups(t){const e=[];return t.forEach((t=>{const i=new u.Z(t);e.push(i)})),e}createForm(){const t=document.createElement("form");t.classList.add(n);const e=document.createElement(l.Z.DIV);e.classList.add(s);const i=this.mainInputsGroup.map((t=>t.getElement()));e.append(...i);const r=this.creatLabelWithGroup(o.Yk.SHIPPING_ADDRESS,this.shippingInputsGroup),a=this.creatLabelWithGroup(o.Yk.BILLING_ADDRESS,this.billingInputsGroup),u=document.createElement(l.Z.BUTTON);u.classList.add("registrationView__button--zQmzn"),u.type=c.BUTTON,u.textContent=S.Z.BUTTON_SUBMIT,u.addEventListener(h.Z.CLICK,this.formSubmitHandler.bind(this));const d=document.createElement(l.Z.DIV);return d.classList.add("registrationView__buttonWrap--Nq_7J"),d.append(u),t.append(e,r,a,d),t}creatLabelWithGroup(t,e){const i=e.map((t=>t.getElement()));let s=document.createElement("label");return t===o.Yk.SHIPPING_ADDRESS&&(this.shippingLabel.append(...i),this.shippingLabel.append(this.buttonDefaultShippingAddress),this.buttonDefaultShippingAddress.addEventListener(h.Z.CLICK,this.defaultShippingToggleHandler.bind(this)),s=this.shippingLabel),t===o.Yk.BILLING_ADDRESS&&(this.billingLabel.append(...i),this.billingLabel.append(this.buttonDefaultBillingAddress),this.buttonDefaultBillingAddress.addEventListener(h.Z.CLICK,this.defaultBillingToggleHandler.bind(this)),s=this.billingLabel),s}createDefaultButton(t,e){const i=document.createElement(l.Z.BUTTON);return i.type=c.BUTTON,i.textContent=t,i.classList.add(...e),i}passwordCheckHandler(){const t=this.inputs[g.REPEAT_PASSWORD];this.inputs[g.PASSWORD].getInputValue()===t.getInputValue()?(t.setCustomValidity(""),t.removeMessage()):(t.setMessageError(o.WA.PASSWORD_REPEAT),t.setCustomValidity(o.WA.PASSWORD_REPEAT))}validateCountryShippingHandler(){this.validateCountryList(this.inputs[g.SHIPPING_COUNTRY],this.inputs[g.SHIPPING_POSTAL])}validateCountryBillingHandler(){this.validateCountryList(this.inputs[g.BILLING_COUNTRY],this.inputs[g.BILLING_POSTAL])}validateCountryList(t,e){const i=this.countryOption.getCountryList(),s=t,n=e,r=s.getInputValue();i.flat().includes(r)?(this.changePostalPatternWithCountry(n,i,r),s.setCustomValidity("")):(s.setCustomValidity(o.WA.COUNTRY_HINT),this.changePostalPatternWithOutCountry(n))}changePostalPatternWithCountry(t,e,i){e.forEach(((e,s)=>{if(e.includes(i)){const e=Array.from(Object.values(m.Z))[s];t.setPattern(e);const n=Array.from(Object.values(A.Z))[s],r=`${i.slice(0,-3)}\`s postal ${n}`;t.setTitle(r),t.setMessageError(r),t.setCustomValidity("")}}))}changePostalPatternWithOutCountry(t){t.setTitle(o.WA.WRONG_COUNTRY),t.setMessageError(o.WA.WRONG_COUNTRY),t.setCustomValidity(o.WA.WRONG_COUNTRY)}defaultBillingToggleHandler(){this.isDefaultBillingAddress?(this.isDefaultBillingAddress=!1,this.buttonDefaultBillingAddress.textContent=S.Z.BUTTON_DEFAULT,this.billingLabel.firstChild.textContent=o.Yk.BILLING_ADDRESS):(this.isDefaultBillingAddress=!0,this.buttonDefaultBillingAddress.textContent=S.Z.BUTTON_UN_DEFAULT,this.billingLabel.firstChild.textContent=o.Yk.BILLING_ADDRESS_DEFAULT)}defaultShippingToggleHandler(){this.isDefaultShippingAddress?(this.isDefaultShippingAddress=!1,this.buttonDefaultShippingAddress.textContent=S.Z.BUTTON_DEFAULT,this.shippingLabel.firstChild.textContent=o.Yk.SHIPPING_ADDRESS):(this.isDefaultShippingAddress=!0,this.buttonDefaultShippingAddress.textContent=S.Z.BUTTON_UN_DEFAULT,this.shippingLabel.firstChild.textContent=o.Yk.SHIPPING_ADDRESS_DEFAULT)}toggleBillingAddressHandler(){const t=this.shippingLabel.parentNode;this.isBillingAddress?(this.isBillingAddress=!1,this.buttonAddAddress.textContent=S.Z.ADD_BILLING_ADDRESS,t.removeChild(this.billingLabel)):(this.isBillingAddress=!0,this.buttonAddAddress.textContent=S.Z.REMOVE_BILLING_ADDRESS,t.insertBefore(this.billingLabel,this.shippingLabel))}changeInputDateHandler(){!0===this.inputs[g.DATE_OF_BIRTH].getInput().checkValidity()?this.inputs[g.DATE_OF_BIRTH].setMessageError(""):this.inputs[g.DATE_OF_BIRTH].setMessageError(o.WA.DATE_OF_BIRTH_HINT)}getParams(){return{email:this.inputs[g.EMAIL].getInputValue(),password:this.inputs[g.PASSWORD].getInputValue(),firstName:this.inputs[g.FIRST_NAME].getInputValue(),lastName:this.inputs[g.LAST_NAME].getInputValue(),dateOfBirth:this.inputs[g.DATE_OF_BIRTH].getInputValue(),countryStreetShipping:this.inputs[g.SHIPPING_STREET].getInputValue(),countryCityShipping:this.inputs[g.SHIPPING_CITY].getInputValue(),countryPostalShipping:this.inputs[g.SHIPPING_POSTAL].getInputValue(),countryShippingCode:this.inputs[g.SHIPPING_COUNTRY].getInputValue().slice(-2),countryStreetBilling:this.isBillingAddress?this.inputs[g.BILLING_STREET].getInputValue():this.inputs[g.SHIPPING_STREET].getInputValue(),countryCityBilling:this.isBillingAddress?this.inputs[g.BILLING_CITY].getInputValue():this.inputs[g.SHIPPING_CITY].getInputValue(),countryPostalBilling:this.isBillingAddress?this.inputs[g.BILLING_POSTAL].getInputValue():this.inputs[g.SHIPPING_POSTAL].getInputValue(),countryBillingCode:this.isBillingAddress?this.inputs[g.BILLING_COUNTRY].getInputValue().slice(-2):this.inputs[g.SHIPPING_COUNTRY].getInputValue().slice(-2),key:`${Date.now().toString(16)}-${Math.trunc(1e10*Math.random()).toString(16)}`,defaultShippingAddressNum:this.isDefaultShippingAddress?0:void 0,defaultBillingAddressNum:this.getDefaultBillinAddressNum()}}getDefaultBillinAddressNum(){let t;return t=this.isBillingAddress?this.isDefaultBillingAddress?1:void 0:this.isDefaultShippingAddress?1:void 0,t}formSubmitHandler(){if(this.isCheckValidityFormHandler()){const t=new L.Z,e=this.getParams(),i={email:this.inputs[g.EMAIL].getInputValue(),password:this.inputs[g.PASSWORD].getInputValue()};t.createCustomer(e).then((t=>{t.statusCode===N.Z.USER_CREATED&&(this.checkValidityElement.textContent=S.Z.REGISTRATION_OK,this.getElement().append(this.checkValidityElement),setTimeout((()=>this.router.navigate(E._.LOGIN)),P.SWITCH_TO_PAGE))})).then((()=>{this.makeLogin(i)})).catch((t=>{this.checkValidityElement.textContent=t.message,this.getElement().append(this.checkValidityElement)}))}else this.getElement().append(this.checkValidityElement)}makeLogin(t){(new T.Z).getCustomer(t).then((e=>{e.body.customer&&(window.localStorage.setItem("isLogin","true"),window.localStorage.setItem(D.Z.MAIL_ADDRESS,t.email),this.observer.notify(C.Z.LOGIN))}))}isCheckValidityFormHandler(){let t=!0;return this.mainInputsGroup.forEach((e=>{e.getInput().checkValidity()||(t=!1)})),this.shippingInputsGroup.forEach((e=>{e.getInput().checkValidity()||(t=!1)})),this.isBillingAddress&&this.billingInputsGroup.forEach((e=>{e.getInput().checkValidity()||(t=!1)})),t}createMainParams(){const t=new B.Z,e=[n];return[t.getMailParams([n]),t.getPasswordParams(e,[[this.passwordCheckHandler.bind(this),h.Z.CHANGE]]),t.getPasswordRepeatParams(e,[[this.passwordCheckHandler.bind(this),h.Z.CHANGE]]),t.getFirstNameParams(e),t.getLastNameParams(e),t.getDateParams(e,[[this.changeInputDateHandler.bind(this),h.Z.CLICK]])]}createShippingAddressParams(){const t=new B.Z,e=[n];return[t.getStreetParams(e),t.getCityParams(e),t.getSPostalParams(e),t.getCountryParams(e,[[this.validateCountryShippingHandler.bind(this),h.Z.CHANGE]])]}createBillingAddressParams(){const t=new B.Z,e=[n];return[t.getStreetParams(e),t.getCityParams(e),t.getSPostalParams(e),t.getCountryParams(e,[[this.validateCountryBillingHandler.bind(this),h.Z.CHANGE]])]}}}}]);