"use strict";(self.webpackChunkecommerce_application=self.webpackChunkecommerce_application||[]).push([[750],{750:(e,t,s)=>{s.d(t,{getView:()=>b});var i=s(37),o=s(631);const a="best-games",r="best-games",n=(e,t)=>{const s={host:"https://auth.europe-west1.gcp.commercetools.com",projectKey:r,credentials:{clientId:"A8PxwfHMEiItZ24oahyDGO2A",clientSecret:"RKi7doGwQ75b4wfuLsPuahDT366uOhUY",user:{username:e,password:t}},scopes:[`manage_project:${r}`],fetch},i={host:"https://api.europe-west1.gcp.commercetools.com",fetch};return(new o.Qx).withPasswordFlow(s).withProjectKey(r).withHttpMiddleware(i).withLoggerMiddleware().build()};class l{constructor(e){if(this.clientRoot=(0,i.mv)((()=>{const e={host:"https://auth.europe-west1.gcp.commercetools.com",projectKey:a,credentials:{clientId:"A8PxwfHMEiItZ24oahyDGO2A",clientSecret:"RKi7doGwQ75b4wfuLsPuahDT366uOhUY",anonymousId:`best-games-${Math.random()}`},scopes:[`manage_project:${a}`]},t={host:"https://api.europe-west1.gcp.commercetools.com",fetch};return(new o.Qx).withAnonymousSessionFlow(e).withProjectKey(a).withHttpMiddleware(t).withLoggerMiddleware().build()})()).withProjectKey({projectKey:"best-games"}),this.createCart=e=>this.clientRoot.carts().post({body:{key:`test-cart-key-${Math.random()}`,currency:"RUB",country:"RU",customerId:e}}).execute(),e){const t=n(e.email,e.password);this.clientRoot=(0,i.mv)(t).withProjectKey({projectKey:"best-games"})}}checkCustomerExist(e){return this.returnCustomerByEmail(e).then((e=>e))}returnCustomerByEmail(e){return this.clientRoot.customers().get({queryArgs:{where:`email="${e}"`}}).execute()}returnCustomerById(e){return this.clientRoot.customers().get({queryArgs:{where:`id="${e}"`}}).execute()}getCustomer({email:e,password:t}){return this.clientRoot.me().login().post({body:{email:e,password:t,updateProductData:!0}}).execute()}createUserRoot(e,t){const s=n(e,t);return this.clientRoot=(0,i.mv)(s).withProjectKey({projectKey:"best-games"}),this.clientRoot}getCartByCustomerId(e){return console.log(this.clientRoot),this.clientRoot.carts().withCustomerId({customerId:e}).get().execute()}createCustomerDraft(e){const{email:t,password:s,firstName:i,lastName:o,countryCode:a,key:r}=e;return{email:t,password:s,key:r,firstName:i,lastName:o,addresses:[{country:a}],defaultShippingAddress:0}}createCustomer(e){try{return this.clientRoot.customers().post({body:this.createCustomerDraft(e)}).execute()}catch(e){return e}}}var m=s(567),d=s(602),c=s(928);const u={"login-view":"login-view--xYXHF","registration-field":"registration-field--rfaSb","login-title":"login-title--ZnrER","registration-field__title":"registration-field__title--IH0AX","login-subtitle":"login-subtitle--Bhb9b","login-form":"login-form--JFEMt","login-form__show-password":"login-form__show-password--r1rU6","login-form__popup":"login-form__popup--Td1nV","password-block":"password-block--dqC0n",button:"button--KUb8s",field:"field--_0gSU",disabled:"disabled--LALv4"};var h=s(296),g=s(881),w=s(891);const E=/(?=.*[0-9])/g,p=/(?=.*[a-z])/,_=/(?=.*[A-Z])/,I=/(?=.*[!@#$%^&*])/,N=/[0-9a-zA-Z!@#$%^&*]{8,}/,A=/(^\S*$)/,C=/[a-z0-9._%+-]+@[a-z0-9.-]+.[a-z]{2,4}/;var S;!function(e){e.FILL_EMAIL="Please fill the field email.",e.FILL_PASSWORD="Please fill the field password.",e.MAIL_NOT_REGISTERED="This email address has not been registered.",e.SUCCESS_LOGIN="Welcome! You are logged!.",e.PASSWORD_IS_WRONG="Password is wrong!",e.EMAIL_CONTAIN_WHITESPACE="Email address must not contain leading or trailing whitespace.",e.EMAIL_WRONG_FORMAT="Email address must be properly formatted (e.g., user@example.com).",e.PASSWORD_CONTAIN_WHITESPACE="Password must not contain leading or trailing whitespace.",e.PASSWORD_NOT_CONTAIN_DIGIT="Password must contain at least one digit (0-9).",e.PASSWORD_NOT_CONTAIN_LOWER_LETTER="Password must contain at least one lowercase letter (a-z).",e.PASSWORD_NOT_CONTAIN_UPPER_LETTER="Password must contain at least one uppercase letter (A-Z).",e.PASSWORD_NOT_CONTAIN_SIMBOLS="Password must contain at least one special character (e.g., !@#$%^&*).",e.PASSWORD_LENGTH_NOT_ENOUTH="Password must be at least 8 characters long."}(S||(S={}));class O extends c.Z{constructor(e){super({tag:m.Z.SECTION,classNames:[u["login-view"]],textContent:""}),this.loginEmail=new d.Z({tag:m.Z.INPUT,classNames:[u.login_form__email,u.field],textContent:"email"}),this.loginPassword=new d.Z({tag:m.Z.INPUT,classNames:[u["login-form__password"],u.field],textContent:"password"}),this.passwordElement=this.loginPassword.getElement(),this.emailElement=this.loginEmail.getElement(),this.router=e,this.observer=h.Z.getInstance(),this.observer?.subscribe(g.Z.LOGOUT,this.updateLoginPage.bind(this)),this.anonimApi=new l,"true"===localStorage.getItem("isLogin")?(console.log("localStorage",localStorage.getItem("isLogin")),this.router.navigate(w._.INDEX)):this.configView()}configView(){this.renderForm()}updateLoginPage(){this.getCreator().clearInnerContent(),this.configView(),this.anonimApi=new l}renderForm(){const e=new d.Z({tag:m.Z.SPAN,classNames:[u["login-title"]],textContent:"EXISTING CUSTOMERS"}),t=new d.Z({tag:m.Z.SPAN,classNames:[u["login-subtitle"]],textContent:"Sign Into Best Games"}),s=new d.Z({tag:m.Z.DIV,classNames:[u["login-form"]],textContent:""}),i=new d.Z({tag:m.Z.DIV,classNames:[u["password-block"]],textContent:""}),o=new d.Z({tag:m.Z.BUTTON,classNames:[u["login-form__show-password"],u.button],textContent:"SHOW"}),a=new d.Z({tag:m.Z.BUTTON,classNames:[u["login-form__submit-button"],u.button],textContent:"SIGN IN"}),r=new d.Z({tag:m.Z.DIV,classNames:[u["registration-field"]],textContent:""}),n=new d.Z({tag:m.Z.SPAN,classNames:[u["registration-field__title"]],textContent:"NEW CUSTOMERS"}),l=new d.Z({tag:m.Z.BUTTON,classNames:[u["register-link"],u.button],textContent:"REGISTER NOW"});s.getElement().setAttribute("action","#"),this.emailElement.setAttribute("type","email"),this.emailElement.setAttribute("name","email"),this.emailElement.setAttribute("placeholder","email"),this.emailElement.setAttribute("Required","true"),this.passwordElement.setAttribute("type","password"),this.passwordElement.setAttribute("name","password"),this.passwordElement.setAttribute("placeholder","password"),this.passwordElement.setAttribute("Required","true"),this.emailElement.addEventListener("input",(()=>this.validateEmail())),this.passwordElement.addEventListener("input",(()=>this.validatePassword())),o.getElement().addEventListener("click",(e=>this.showPassword(e))),a.getElement().addEventListener("click",(e=>this.submitLogin(e))),l.getElement().addEventListener("click",(()=>{this.router.navigate(w._.REGISTRATION)})),s.addInnerElement(e),s.addInnerElement(t),s.addInnerElement(this.loginEmail),i.addInnerElement(this.loginPassword),i.addInnerElement(o),s.addInnerElement(i),s.addInnerElement(a),r.addInnerElement(n),r.addInnerElement(l),this.getCreator().addInnerElement(s),this.getCreator().addInnerElement(r)}showPassword(e){e.preventDefault(),"password"===this.passwordElement.getAttribute("type")?this.passwordElement.setAttribute("type","text"):this.passwordElement.setAttribute("type","password")}submitLogin(e){e.preventDefault();const t=this.emailElement.value,s=this.passwordElement.value;t||(this.emailElement.setCustomValidity(S.FILL_EMAIL),this.emailElement.reportValidity()),s||(this.passwordElement.setCustomValidity(S.FILL_PASSWORD),this.passwordElement.reportValidity()),0!==t.length&&0!==s.length&&this.validatePassword()&&this.validateEmail()&&(void 0!==t&&this.anonimApi.checkCustomerExist(t).then((e=>{0===e.body.results.length?(this.emailElement.setCustomValidity(S.MAIL_NOT_REGISTERED),this.emailElement.reportValidity()):console.log()})).catch(console.error),this.anonimApi.getCustomer({email:t,password:s}).then((e=>{e.body.customer&&(console.log("all response",e),window.localStorage.setItem("isLogin","true"),this.observer.notify(g.Z.LOGIN),this.router.navigate(w._.INDEX),this.userApi=new l({email:t,password:s}),this.userApi.returnCustomerById(e.body.customer.id))})).catch((()=>{this.passwordElement.setCustomValidity(S.PASSWORD_IS_WRONG),this.passwordElement.reportValidity()})))}validateEmail(){const{value:e}=this.loginEmail.getElement();switch(this.emailElement.setCustomValidity(""),!0){case!A.test(e):this.emailElement.setCustomValidity(S.EMAIL_CONTAIN_WHITESPACE);break;case!C.test(e):this.emailElement.setCustomValidity(S.EMAIL_WRONG_FORMAT);break;default:return this.emailElement.setCustomValidity(""),!0}return this.emailElement.reportValidity(),!1}validatePassword(){const{value:e}=this.passwordElement;switch(this.passwordElement.setCustomValidity(""),!0){case!A.test(e):this.passwordElement.setCustomValidity(S.PASSWORD_CONTAIN_WHITESPACE);break;case!E.test(e):this.passwordElement.setCustomValidity(S.PASSWORD_NOT_CONTAIN_DIGIT);break;case!p.test(e):this.passwordElement.setCustomValidity(S.PASSWORD_NOT_CONTAIN_LOWER_LETTER);break;case!_.test(e):this.passwordElement.setCustomValidity(S.PASSWORD_NOT_CONTAIN_UPPER_LETTER);break;case!I.test(e):this.passwordElement.setCustomValidity(S.PASSWORD_NOT_CONTAIN_SIMBOLS);break;case!N.test(e):this.passwordElement.setCustomValidity(S.PASSWORD_LENGTH_NOT_ENOUTH);break;default:return this.passwordElement.setCustomValidity(""),!0}return this.passwordElement.reportValidity(),!1}createMessagePopup(e){const t=new d.Z({tag:m.Z.DIV,classNames:[u["login-form__popup"]],textContent:e});this.getCreator().addInnerElement(t),t.getElement().addEventListener("click",(()=>{t.getElement().remove()}))}}function b(e){return new O(e)}}}]);